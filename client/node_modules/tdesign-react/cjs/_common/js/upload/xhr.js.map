{"version":3,"file":"xhr.js","sources":["../../../../src/_common/js/upload/xhr.ts"],"sourcesContent":["import { XhrOptions } from './types';\n\nexport default function xhr({\n  action,\n  withCredentials = false,\n  headers = {},\n  data = {},\n  file,\n  name = 'file',\n  onError,\n  onProgress,\n  onSuccess,\n}: XhrOptions) {\n  // eslint-disable-next-line no-shadow\n  const xhr = new XMLHttpRequest();\n  if (withCredentials) {\n    xhr.withCredentials = true;\n  }\n\n  // set send data\n  const formData = new FormData();\n  const sendData = typeof data === 'function' ? data(file) : data;\n  Object.keys(sendData).forEach((key) => {\n    formData.append(key, data[key]);\n  });\n  formData.append(name, file.raw);\n\n  xhr.open('post', action, true);\n\n  // custom request headers\n  Object.keys(headers).forEach((key) => {\n    xhr.setRequestHeader(key, headers[key]);\n  });\n\n  xhr.onerror = (event: ProgressEvent) => onError({ event, file });\n\n  if (xhr.upload) {\n    xhr.upload.onprogress = (event: ProgressEvent) => {\n      let percent = 0;\n      if (event.total > 0) {\n        percent = Math.round((event.loaded / event.total) * 100);\n      }\n      onProgress({ event, percent, file });\n    };\n  }\n\n  // eslint-disable-next-line consistent-return\n  xhr.onload = (event: ProgressEvent) => {\n    let response;\n    const isFail = xhr.status < 200 || xhr.status >= 300;\n    if (isFail) {\n      return onError({ event, file, response });\n    }\n    const text = xhr.responseText || xhr.response;\n    try {\n      response = JSON.parse(text);\n    } catch (e) {\n      response = text;\n    }\n    onSuccess({ event, file, response });\n  };\n\n  xhr.send(formData);\n\n  return xhr;\n}\n"],"names":["xhr","action","withCredentials","headers","data","file","name","onError","onProgress","onSuccess","xhr2","XMLHttpRequest","formData","FormData","sendData","Object","keys","forEach","key","append","raw","open","setRequestHeader","onerror","event","upload","onprogress","percent","total","Math","round","loaded","onload","response","isFail","status","text","responseText","JSON","parse","e","send"],"mappings":"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"}