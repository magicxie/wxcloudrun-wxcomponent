{"version":3,"file":"useRipple.js","sources":["../../src/_util/useRipple.ts"],"sourcesContent":["import { useEffect, useCallback, RefObject } from 'react';\nimport useConfig from './useConfig';\nimport setStyle from './setStyle';\n\nconst period = 200;\nconst noneRippleBg = 'rgba(0, 0, 0, 0)';\nconst defaultRippleColor = 'rgba(0, 0, 0, 0.35)';\n\n// 设置动画颜色 get the ripple animation color\nconst getRippleColor = (el: HTMLElement, fixedRippleColor?: string) => {\n  // get fixed color from params\n  if (fixedRippleColor) {\n    return fixedRippleColor;\n  }\n  // get dynamic color from the dataset\n  if (el?.dataset?.ripple) {\n    const rippleColor = el.dataset.ripple;\n    return rippleColor;\n  }\n  // use css variable\n  const cssVariable = getComputedStyle(el).getPropertyValue('--ripple-color');\n  if (cssVariable) {\n    return cssVariable;\n  }\n  return defaultRippleColor;\n};\n\n/**\n * 斜八角动画hooks 支持三种方式使用\n * 1. fixedRippleColor 固定色值 useRipple(ref,fixedRippleColor);\n * 2. dynamicColor 动态色值 data.ripple=\"rippleColor\" useRipple(ref)\n * 3. CSS variables（recommended） 配合节点对应CSS设置 --ripple-color useRipple(ref)\n * @param ref 需要使用斜八角动画的DOM\n * @param fixedRippleColor 斜八角的动画颜色\n */\nexport default function useRipple(ref: RefObject<HTMLElement>, fixedRippleColor?: string): void {\n  const { classPrefix } = useConfig();\n\n  const rippleContainer = document.createElement('div');\n  // 为节点添加斜八角动画 add ripple to the DOM and set up the animation\n  const handleAddRipple = useCallback(\n    (e) => {\n      const el = ref?.current;\n      const rippleColor = getRippleColor(el, fixedRippleColor);\n\n      if (e.button !== 0 || !el) return;\n\n      if (\n        el.classList.contains(`${classPrefix}-is-active`) ||\n        el.classList.contains(`${classPrefix}-is-disabled`) ||\n        el.classList.contains(`${classPrefix}-is-checked`)\n      )\n        return;\n\n      const elStyle = getComputedStyle(el);\n\n      const elBorder = parseInt(elStyle.borderWidth, 10);\n      const border = elBorder > 0 ? elBorder : 0;\n      const width = el.offsetWidth;\n      const height = el.offsetHeight;\n\n      if (rippleContainer.parentNode === null) {\n        setStyle(rippleContainer, {\n          position: 'absolute',\n          left: `${0 - border}px`,\n          top: `${0 - border}px`,\n          width: `${width}px`,\n          height: `${height}px`,\n          borderRadius: elStyle.borderRadius,\n          pointerEvents: 'none',\n          overflow: 'hidden',\n        });\n        el.appendChild(rippleContainer);\n      }\n      // 新增一个ripple\n      const ripple = document.createElement('div');\n\n      setStyle(ripple, {\n        marginTop: '0',\n        marginLeft: '0',\n        right: `${width}px`,\n        width: `${width + 20}px`,\n        height: '100%',\n        transition: `transform ${period}ms cubic-bezier(.38, 0, .24, 1), background ${period * 2}ms linear`,\n        transform: 'skewX(-8deg)',\n        pointerEvents: 'none',\n        position: 'absolute',\n        zIndex: 0,\n        backgroundColor: rippleColor,\n        opacity: '0.9',\n      });\n\n      // fix zIndex：避免遮盖内部元素\n      const elMap = new WeakMap();\n      for (let n = el.children.length, i = 0; i < n; ++i) {\n        const child = el.children[i];\n        if ((child as HTMLElement).style.zIndex === '' && child !== rippleContainer) {\n          (child as HTMLElement).style.zIndex = '1';\n          elMap.set(child, true);\n        }\n      }\n\n      // fix position\n      const initPosition = el.style.position ? el.style.position : getComputedStyle(el).position;\n      if (initPosition === '' || initPosition === 'static') {\n        // eslint-disable-next-line no-param-reassign\n        el.style.position = 'relative';\n      }\n      rippleContainer.insertBefore(ripple, rippleContainer.firstChild);\n\n      setTimeout(() => {\n        ripple.style.transform = `translateX(${width}px)`;\n      }, 0);\n      // 清除动画节点 clear ripple container\n      const handleClearRipple = () => {\n        const el = ref?.current;\n        ripple.style.backgroundColor = noneRippleBg;\n\n        if (!el) return;\n\n        el.removeEventListener('pointerup', handleClearRipple, false);\n        el.removeEventListener('pointerleave', handleClearRipple, false);\n\n        setTimeout(() => {\n          ripple.remove();\n          if (rippleContainer.children.length === 0) rippleContainer.remove();\n        }, period * 2 + 100);\n      };\n      el.addEventListener('pointerup', handleClearRipple, false);\n      el.addEventListener('pointerleave', handleClearRipple, false);\n    },\n    [classPrefix, ref, fixedRippleColor, rippleContainer],\n  );\n\n  // 重置一些属性 为动画做准备 reset the node which uses the ripple animation\n  const initRippleElement = useCallback(() => {\n    const el = ref?.current;\n\n    if (!el) return;\n\n    const initPosition = el.style?.position || getComputedStyle(el).position;\n    if (['', 'static'].includes(initPosition)) {\n      el.style.position = 'relative';\n    }\n  }, [ref]);\n\n  useEffect(() => {\n    const el = ref?.current;\n    if (!el) return;\n\n    initRippleElement();\n\n    el.addEventListener('pointerdown', handleAddRipple, false);\n\n    return () => {\n      el.removeEventListener('pointerdown', handleAddRipple, false);\n    };\n  }, [initRippleElement, handleAddRipple, fixedRippleColor, ref]);\n}\n"],"names":["period","noneRippleBg","defaultRippleColor","getRippleColor","el","fixedRippleColor","dataset","ripple","rippleColor","cssVariable","getComputedStyle","getPropertyValue","useRipple","ref","useConfig","classPrefix","rippleContainer","document","createElement","handleAddRipple","useCallback","e","current","button","classList","contains","elStyle","elBorder","parseInt","borderWidth","border","width","offsetWidth","height","offsetHeight","parentNode","setStyle","position","left","top","borderRadius","pointerEvents","overflow","appendChild","marginTop","marginLeft","right","transition","transform","zIndex","backgroundColor","opacity","elMap","WeakMap","n","children","length","i","child","style","set","initPosition","insertBefore","firstChild","setTimeout","handleClearRipple","el2","removeEventListener","remove","addEventListener","initRippleElement","includes","useEffect"],"mappings":"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"}