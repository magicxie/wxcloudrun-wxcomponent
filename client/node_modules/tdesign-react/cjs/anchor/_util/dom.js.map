{"version":3,"file":"dom.js","sources":["../../../src/anchor/_util/dom.ts"],"sourcesContent":["import raf from 'raf';\nimport { easeInOutCubic, EasingFunction } from '../../_util/easing';\n\nexport type AnchorContainer = HTMLElement | Window;\n\nexport function getOffsetTop(target: HTMLElement, container: AnchorContainer) {\n  const { top } = target.getBoundingClientRect();\n  if (container === window) {\n    // 减去document的边框\n    return top - document.documentElement.clientTop;\n  }\n  return top - (container as HTMLElement).getBoundingClientRect().top;\n}\n\n/**\n * 返回是否window对象\n *\n * @export\n * @param {any} obj\n * @returns\n */\nfunction isWindow(obj: any) {\n  return obj && obj === obj.window;\n}\n\ntype ScrollTarget = HTMLElement | Window | Document;\n\n/**\n * 获取滚动距离\n *\n * @export\n * @param {ScrollTarget} target\n * @param {boolean} isLeft true为获取scrollLeft, false为获取scrollTop\n * @returns {number}\n */\nexport function getScroll(target: ScrollTarget, isLeft?: boolean): number {\n  // node环境或者target为空\n  if (typeof window === 'undefined' || !target) {\n    return 0;\n  }\n  const method = isLeft ? 'scrollLeft' : 'scrollTop';\n  let result = 0;\n  if (isWindow(target)) {\n    result = (target as Window)[isLeft ? 'pageXOffset' : 'pageYOffset'];\n  } else if (target instanceof Document) {\n    result = target.documentElement[method];\n  } else if (target) {\n    result = (target as HTMLElement)[method];\n  }\n  return result;\n}\n\ninterface ScrollTopOptions {\n  container?: ScrollTarget;\n  duration?: number;\n  easing?: EasingFunction;\n}\nexport function scrollTo(target: number, opt: ScrollTopOptions) {\n  const { container = window, duration = 450, easing = easeInOutCubic } = opt;\n  const scrollTop = getScroll(container);\n  const startTime = Date.now();\n  return new Promise((res) => {\n    const fnc = () => {\n      const timestamp = Date.now();\n      const time = timestamp - startTime;\n      const nextScrollTop = easing(Math.min(time, duration), scrollTop, target, duration);\n      if (isWindow(container)) {\n        (container as Window).scrollTo(window.pageXOffset, nextScrollTop);\n      } else if (container instanceof HTMLDocument || container.constructor.name === 'HTMLDocument') {\n        (container as HTMLDocument).documentElement.scrollTop = nextScrollTop;\n      } else {\n        (container as HTMLElement).scrollTop = nextScrollTop;\n      }\n      if (time < duration) {\n        raf(fnc);\n      } else {\n        // 由于上面步骤设置了scrollTop, 滚动事件可能未触发完毕\n        // 此时应该在下一帧再执行res\n        raf(res);\n      }\n    };\n    raf(fnc);\n  });\n}\n"],"names":["getOffsetTop","target","container","getBoundingClientRect","top","window","document","documentElement","clientTop","isWindow","obj","getScroll","isLeft","method","result","Document","scrollTo","opt","duration","easing","easeInOutCubic","scrollTop","startTime","Date","now","Promise","res","fnc","timestamp","time","nextScrollTop","Math","min","pageXOffset","HTMLDocument","constructor","name","raf"],"mappings":"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"}