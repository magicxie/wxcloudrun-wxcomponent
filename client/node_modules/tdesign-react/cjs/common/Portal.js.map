{"version":3,"file":"Portal.js","sources":["../../src/common/Portal.tsx"],"sourcesContent":["import React, { forwardRef, useEffect, useMemo, useImperativeHandle } from 'react';\nimport { createPortal } from 'react-dom';\nimport { AttachNode, AttachNodeReturnValue } from '../common';\n\nexport interface PortalProps {\n  /**\n   * 指定挂载的 HTML 节点, false 为挂载在 body\n   */\n  getContainer?: React.ReactElement | AttachNode | boolean;\n  children: React.ReactNode;\n}\n\nexport function getAttach(attach: PortalProps['getContainer']) {\n  let parent: AttachNodeReturnValue;\n  if (typeof attach === 'string') {\n    parent = document.querySelector(attach);\n  }\n  if (typeof attach === 'function') {\n    parent = attach();\n  }\n  if (typeof attach === 'object' && attach instanceof window.HTMLElement) {\n    parent = attach;\n  }\n  return parent || document.body;\n}\n\nconst Portal = forwardRef((props: PortalProps, ref) => {\n  const { getContainer, children } = props;\n  const [parentContainer, container] = useMemo(() => {\n    const parent = getAttach(getContainer);\n\n    if (parent) {\n      const div = document.createElement('div');\n      parent.appendChild(div);\n      return [parent, div];\n    }\n  }, [getContainer]);\n\n  useEffect(\n    () => () => {\n      container.remove();\n    }, // eslint-disable-next-line react-hooks/exhaustive-deps\n    [],\n  );\n\n  useImperativeHandle(ref, () => parentContainer);\n\n  return createPortal(children, container);\n});\n\nPortal.displayName = 'Portal';\n\nexport default Portal;\n"],"names":["getAttach","attach","parent","document","querySelector","_typeof","window","HTMLElement","body","Portal","forwardRef","props","ref","getContainer","children","useMemo","div","createElement","appendChild","parentContainer","container","useEffect","remove","useImperativeHandle","createPortal","displayName"],"mappings":";;;;;;;;;;;;;;;;AAEO,SAASA,SAAT,CAAmBC,MAAnB,EAA2B;AAChC,MAAIC,MAAJ;;AACA,MAAI,OAAOD,MAAP,KAAkB,QAAtB,EAAgC;AAC9BC,IAAAA,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuBH,MAAvB,CAAT;AACD;;AACD,MAAI,OAAOA,MAAP,KAAkB,UAAtB,EAAkC;AAChCC,IAAAA,MAAM,GAAGD,MAAM,EAAf;AACD;;AACD,MAAII,gBAAOJ,MAAP,MAAkB,QAAlB,IAA8BA,MAAM,YAAYK,MAAM,CAACC,WAA3D,EAAwE;AACtEL,IAAAA,MAAM,GAAGD,MAAT;AACD;;AACD,SAAOC,MAAM,IAAIC,QAAQ,CAACK,IAA1B;AACD;IACKC,MAAM,gBAAGC,gBAAU,CAAC,UAACC,KAAD,EAAQC,GAAR,EAAgB;AACxC,MAAQC,YAAR,GAAmCF,KAAnC,CAAQE,YAAR;AAAA,MAAsBC,QAAtB,GAAmCH,KAAnC,CAAsBG,QAAtB;;AACA,iBAAqCC,aAAO,CAAC,YAAM;AACjD,QAAMb,MAAM,GAAGF,SAAS,CAACa,YAAD,CAAxB;;AACA,QAAIX,MAAJ,EAAY;AACV,UAAMc,GAAG,GAAGb,QAAQ,CAACc,aAAT,CAAuB,KAAvB,CAAZ;AACAf,MAAAA,MAAM,CAACgB,WAAP,CAAmBF,GAAnB;AACA,aAAO,CAACd,MAAD,EAASc,GAAT,CAAP;AACD;AACF,GAP2C,EAOzC,CAACH,YAAD,CAPyC,CAA5C;AAAA;AAAA,MAAOM,eAAP;AAAA,MAAwBC,SAAxB;;AAQAC,EAAAA,eAAS,CAAC;AAAA,WAAM,YAAM;AACpBD,MAAAA,SAAS,CAACE,MAAV;AACD,KAFS;AAAA,GAAD,EAEN,EAFM,CAAT;AAGAC,EAAAA,yBAAmB,CAACX,GAAD,EAAM;AAAA,WAAMO,eAAN;AAAA,GAAN,CAAnB;AACA,sBAAOK,qBAAY,CAACV,QAAD,EAAWM,SAAX,CAAnB;AACD,CAfwB;AAgBzBX,MAAM,CAACgB,WAAP,GAAqB,QAArB;;;;;"}