{"version":3,"file":"Date.js","sources":["../../../src/date-picker/panel/Date.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo } from 'react';\nimport { useLocaleReceiver } from '../../locale/LocalReceiver';\nimport useConfig from '../../_util/useConfig';\nimport noop from '../../_util/noop';\nimport DateHeader from '../base/Header';\nimport DateTable from '../base/Table';\nimport { getWeeks, getYears, getMonths, flagActive, subtractMonth, addMonth, getToday } from '../utils';\n\nexport type DateType = 'year' | 'month' | 'date';\nexport interface DatePanelProps {\n  value: Date;\n  mode: DateType;\n  minDate: Date;\n  maxDate: Date;\n  firstDayOfWeek: number;\n  disableDate: Function;\n  onChange: Function;\n}\n\nconst TODAY = getToday();\n\nconst DatePanel = (props: DatePanelProps) => {\n  // 国际化文本初始化\n  const [local, t] = useLocaleReceiver('datePicker');\n  const monthAriaLabel = t(local.monthAriaLabel);\n\n  const { classPrefix } = useConfig();\n  const { value, mode, minDate, maxDate, firstDayOfWeek, disableDate, onChange } = props;\n\n  const [year, setYear] = useState(value.getFullYear());\n  const [month, setMonth] = useState(value.getMonth());\n  const [type, setType] = useState(mode);\n\n  useEffect(() => {\n    setType(mode);\n  }, [mode]);\n\n  useEffect(() => {\n    setYear(value.getFullYear());\n    setMonth(value.getMonth());\n  }, [value]);\n\n  function clickHeader(flag: number) {\n    let monthCount = 0;\n    let next = null;\n    switch (type) {\n      case 'date':\n        monthCount = 1;\n        break;\n      case 'month':\n        monthCount = 12;\n        break;\n      case 'year':\n        monthCount = 120;\n    }\n\n    const current = new Date(year, month);\n\n    switch (flag) {\n      case 1:\n        next = addMonth(current, monthCount);\n        break;\n      case -1:\n        next = subtractMonth(current, monthCount);\n        break;\n      case 0:\n        next = new Date();\n        break;\n    }\n\n    setYear(next.getFullYear());\n    setMonth(next.getMonth());\n  }\n\n  const tableData = useMemo(() => {\n    let data: any[];\n\n    const options = {\n      disableDate,\n      minDate,\n      maxDate,\n      firstDayOfWeek,\n      monthText: monthAriaLabel,\n    };\n\n    switch (type) {\n      case 'date':\n        data = getWeeks({ year, month }, options);\n        break;\n      case 'month':\n        data = getMonths(year, options);\n        break;\n      case 'year':\n        data = getYears(year, options);\n        break;\n      default:\n        break;\n    }\n    const start = type === 'date' || type === mode ? value : new Date(year, month);\n    return flagActive(data, { start, type });\n  }, [year, month, type, value, mode, disableDate, minDate, maxDate, firstDayOfWeek, monthAriaLabel]);\n\n  function getClickHandler(date) {\n    if (type === 'date') {\n      onChange?.(date);\n    } else if (type === 'month') {\n      if (mode === 'month') {\n        onChange?.(date);\n      } else {\n        setType('date');\n        setYear(date.getFullYear());\n        setMonth(date.getMonth());\n      }\n    } else if (type === 'year') {\n      if (mode === 'year') {\n        onChange?.(date);\n      } else {\n        setType('month');\n        setYear(date.getFullYear());\n      }\n    }\n  }\n\n  return (\n    <div className={`${classPrefix}-date-picker__panel`}>\n      <DateHeader year={year} month={month} type={type} onBtnClick={clickHeader} onTypeChange={setType} />\n      <DateTable\n        type={type}\n        firstDayOfWeek={firstDayOfWeek}\n        data={tableData}\n        onCellClick={getClickHandler}\n        onCellMouseEnter={noop}\n      />\n    </div>\n  );\n};\n\nDatePanel.displayName = 'DatePanel';\nDatePanel.defaultProps = {\n  value: TODAY,\n  mode: 'date',\n};\n\nexport default DatePanel;\n"],"names":["TODAY","getToday","DatePanel","props","useLocaleReceiver","local","t","monthAriaLabel","useConfig","classPrefix","value","mode","minDate","maxDate","firstDayOfWeek","disableDate","onChange","useState","getFullYear","year","setYear","getMonth","month","setMonth","type","setType","useEffect","clickHeader","flag","monthCount","next","current","Date","addMonth","subtractMonth","tableData","useMemo","data","options","monthText","getWeeks","getMonths","getYears","start","flagActive","getClickHandler","date","React","createElement","className","DateHeader","onBtnClick","onTypeChange","DateTable","onCellClick","onCellMouseEnter","noop","displayName","defaultProps"],"mappings":"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"}