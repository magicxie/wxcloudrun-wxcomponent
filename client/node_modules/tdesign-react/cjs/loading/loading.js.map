{"version":3,"file":"loading.js","sources":["../../src/loading/loading.tsx"],"sourcesContent":["import React, { useState, useEffect, FC, useMemo, CSSProperties } from 'react';\nimport classnames from 'classnames';\n\nimport { addClass, removeClass } from '../_util/dom';\nimport useConfig from '../_util/useConfig';\nimport { StyledProps } from '../common';\nimport { TdLoadingProps } from './type';\nimport Portal from '../common/Portal';\nimport Gradient from './gradient';\n\nexport interface LoadingProps extends TdLoadingProps, StyledProps {}\n\nconst Loading: FC<LoadingProps> = (props) => {\n  const {\n    attach,\n    indicator = true,\n    text,\n    loading = true,\n    size = 'medium',\n    delay,\n    fullscreen,\n    preventScrollThrough = true,\n    showOverlay = true,\n    content,\n    children = content,\n    inheritColor = false,\n    zIndex,\n    className,\n  } = props;\n\n  const [showLoading, setShowLoading] = useState(delay ? false : loading);\n\n  const { classPrefix } = useConfig();\n\n  const name = `${classPrefix}-loading`;\n  const centerClass = `${classPrefix}-loading--center`;\n  const inheritColorClass = `${classPrefix}-loading--inherit-color`;\n  const fullClass = `${classPrefix}-loading--full`;\n  const fullscreenClass = `${classPrefix}-loading__fullscreen`;\n  const lockClass = `${classPrefix}-loading--lock`;\n  const overlayClass = `${classPrefix}-loading__overlay`;\n  const relativeClass = `${classPrefix}-loading__parent`;\n  const textClass = `${classPrefix}-loading__text`;\n\n  useEffect(() => {\n    let timer: NodeJS.Timeout;\n\n    if (delay && loading) {\n      timer = setTimeout(() => {\n        setShowLoading(loading);\n      }, delay);\n    } else {\n      setShowLoading(loading);\n    }\n    return () => {\n      clearTimeout(timer);\n    };\n  }, [delay, loading]);\n\n  const calcStyles = useMemo(() => {\n    const styles: CSSProperties = {};\n\n    if (zIndex !== undefined) {\n      styles.zIndex = zIndex;\n    }\n\n    if (!['small', 'medium', 'large'].includes(size)) {\n      styles['font-size'] = size;\n    }\n\n    return styles;\n  }, [size, zIndex]);\n\n  const sizeMap = {\n    large: `${classPrefix}-size-l`,\n    small: `${classPrefix}-size-s`,\n    medium: `${classPrefix}-size-m`,\n  };\n\n  const baseClasses = classnames(\n    centerClass,\n    sizeMap[size],\n    {\n      [inheritColorClass]: inheritColor,\n    },\n    className,\n  );\n\n  if (preventScrollThrough && fullscreen) {\n    if (loading) {\n      addClass(document.body, lockClass);\n    } else {\n      removeClass(document.body, lockClass);\n    }\n  }\n\n  const commonContent = () => {\n    let renderIndicator = <Gradient />;\n\n    if (indicator && typeof indicator !== 'boolean') {\n      renderIndicator = indicator as JSX.Element;\n    }\n    return (\n      <>\n        {indicator ? renderIndicator : null}\n        {text ? <div className={textClass}>{text}</div> : null}\n      </>\n    );\n  };\n\n  if (fullscreen) {\n    return loading ? (\n      <div className={classnames(name, fullscreenClass, centerClass, overlayClass)} style={calcStyles}>\n        <div className={baseClasses}>{commonContent()}</div>\n      </div>\n    ) : null;\n  }\n\n  if (children) {\n    return (\n      <div className={relativeClass}>\n        {children}\n        {showLoading ? (\n          <div\n            className={classnames(name, baseClasses, fullClass, {\n              [overlayClass]: showOverlay,\n            })}\n            style={calcStyles}\n          >\n            {commonContent()}\n          </div>\n        ) : null}\n      </div>\n    );\n  }\n  if (attach) {\n    return (\n      <Portal getContainer={attach}>\n        <div className={classnames(name, baseClasses, fullClass, { [overlayClass]: showOverlay })} style={calcStyles}>\n          {commonContent()}\n        </div>\n      </Portal>\n    );\n  }\n\n  return (\n    <div className={classnames(name, baseClasses)} style={calcStyles}>\n      {commonContent()}\n    </div>\n  );\n};\n\nexport default Loading;\n"],"names":["Loading","props","attach","indicator","text","loading","size","delay","fullscreen","preventScrollThrough","showOverlay","content","children","inheritColor","zIndex","className","useState","showLoading","setShowLoading","useConfig","classPrefix","name","centerClass","inheritColorClass","fullClass","fullscreenClass","lockClass","overlayClass","relativeClass","textClass","useEffect","timer","setTimeout","clearTimeout","calcStyles","useMemo","styles","includes","sizeMap","large","small","medium","baseClasses","classnames","addClass","document","body","removeClass","commonContent","renderIndicator","React","createElement","Gradient","Fragment","style","Portal","getContainer"],"mappings":"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"}