{"version":3,"file":"useTriggerProps.js","sources":["../../../src/popup/hooks/useTriggerProps.ts"],"sourcesContent":["import { HTMLAttributes, MutableRefObject } from 'react';\nimport useClickOutside from '../../_util/useClickOutside';\nimport { TdPopupProps, PopupVisibleChangeContext, PopupTriggerEvent } from '../type';\nimport { ChangeHandler } from '../../_util/useDefault';\n\nexport type TriggerProps = HTMLAttributes<HTMLDivElement>;\nexport type PopupProps = HTMLAttributes<HTMLDivElement>;\ntype HandleTrigger = (e: PopupTriggerEvent, trigger: PopupVisibleChangeContext['trigger']) => void;\nconst ESC_KEY = 'Escape';\n\nexport default function useTriggerProps(\n  ref: MutableRefObject<HTMLElement>,\n  triggerNode: MutableRefObject<HTMLElement>,\n  triggers: Array<TdPopupProps['trigger']>,\n  visible: boolean,\n  setVisible: ChangeHandler<boolean, [PopupVisibleChangeContext]>,\n  disabled = false,\n  originTrigger: JSX.Element,\n): [TriggerProps, PopupProps] {\n  const triggerProps: TriggerProps = {};\n  const popupProps: PopupProps = {};\n\n  const toggle: HandleTrigger = (e, trigger) => setVisible(!visible, { e, trigger });\n  const show: HandleTrigger = (e, trigger) => setVisible(true, { e, trigger });\n  const hide: HandleTrigger = (e, trigger) => setVisible(false, { e, trigger });\n\n  // click outside 用于处理点击其他地方隐藏\n  useClickOutside([ref, triggerNode], (e: any) => {\n    if (visible && (triggers.includes('click') || triggers.includes('context-menu'))) {\n      hide(e, 'trigger-element-blur');\n    }\n  });\n\n  if (disabled) return [triggerProps, popupProps];\n\n  // eslint-disable-next-line no-restricted-syntax\n  for (const trigger of triggers) {\n    const { onClick, onMouseEnter, onMouseLeave, onFocus, onBlur, onContextMenu, onKeyDown } = originTrigger.props;\n    // 点击触发\n    if (trigger === 'click') {\n      triggerProps.onClick = (e) => {\n        toggle(e, 'trigger-element-click');\n        onClick && onClick(e);\n      };\n    }\n\n    // hover 触发\n    if (trigger === 'hover') {\n      triggerProps.onMouseEnter = (e) => {\n        show(e, 'trigger-element-hover');\n        onMouseEnter && onMouseEnter(e);\n      };\n      popupProps.onMouseEnter = (e) => {\n        // 如果当前弹出框本身没有展示 hover时不应该展示\n        visible && show(e, 'trigger-element-hover');\n      }; // 兼容鼠标移入弹出框\n      triggerProps.onMouseLeave = (e) => {\n        hide(e, 'trigger-element-hover');\n        onMouseLeave && onMouseLeave(e);\n      };\n      popupProps.onMouseLeave = (e) => hide(e, 'trigger-element-hover');\n    }\n\n    // focus 触发\n    if (trigger === 'focus') {\n      triggerProps.onFocus = (e) => {\n        show(e, 'trigger-element-focus');\n        onFocus && onFocus(e);\n      };\n      triggerProps.onBlur = (e) => {\n        hide(e, 'trigger-element-blur');\n        onBlur && onBlur(e);\n      };\n    }\n\n    // contextMenu 触发\n    if (trigger === 'context-menu') {\n      triggerProps.onContextMenu = (e) => {\n        show(e, 'context-menu');\n        onContextMenu && onContextMenu(e);\n      };\n    }\n\n    triggerProps.onKeyDown = (e) => {\n      if (e.key === ESC_KEY) hide(e, 'keydown-esc');\n      onKeyDown && onKeyDown(e);\n    };\n  }\n\n  return [triggerProps, popupProps];\n}\n"],"names":["ESC_KEY","useTriggerProps","ref","triggerNode","triggers","visible","setVisible","disabled","originTrigger","triggerProps","popupProps","toggle","e","trigger","show","hide","useClickOutside","includes","props","onClick","onMouseEnter","onMouseLeave","onFocus","onBlur","onContextMenu","onKeyDown","key"],"mappings":"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"}