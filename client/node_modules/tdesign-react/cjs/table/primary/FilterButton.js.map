{"version":3,"file":"FilterButton.js","sources":["../../../src/table/primary/FilterButton.tsx"],"sourcesContent":["import React, { useState, useContext, useEffect } from 'react';\nimport classNames from 'classnames';\nimport isFunction from 'lodash/isFunction';\nimport isString from 'lodash/isString';\nimport { FilterIcon as TIconFilter } from 'tdesign-icons-react';\nimport { Popup } from '../../popup';\nimport { Radio } from '../../radio';\nimport { Checkbox } from '../../checkbox';\nimport { Input } from '../../input';\nimport { TElement } from '../../common';\nimport { TableColumnFilter, FilterValue, PrimaryTableCol, DataType } from '../type';\nimport { ConfigContext } from '../../config-provider';\n\ninterface Props {\n  columns?: Array<PrimaryTableCol>;\n  onChange?: Function;\n  innerfiltVal?: FilterValue;\n  filterIcon?: TElement;\n}\nconst renderIcon = (classPrefix: string, icon: TElement) => {\n  let result: React.ReactNode = null;\n  if (icon) result = icon;\n  if (typeof icon === 'function') result = icon();\n  if (result) {\n    result = <span className={`${classPrefix}-table__filter-icon`}>{result}</span>;\n  } else {\n    result = <TIconFilter className={`${classPrefix}-table__filter-icon`} />;\n  }\n  return result;\n};\n// 该方法主要用于过滤需要调整表头的时，不支持 render 函数的情况\nfunction getTitle(column: PrimaryTableCol, colIndex: number) {\n  let result = null;\n  if (isFunction(column.title)) {\n    result = column.title({ col: column, colIndex });\n  } else if (isString(column.title)) {\n    result = column.title;\n  }\n  return result;\n}\n\n// 处理tilte字段，添加筛选icon\nfunction FilterButton(props: Props) {\n  const { onChange, filterIcon, innerfiltVal, columns } = props;\n  const { classPrefix } = useContext(ConfigContext);\n  const [filterVal, setfilterVal] = useState<any>();\n\n  const getFilterContent = (filter: TableColumnFilter, colKey: string, column: PrimaryTableCol<DataType>) => {\n    const types = ['single', 'multiple', 'input'];\n    if (filter.type && !types.includes(filter.type)) {\n      console.error(`column.type must be the following: ${JSON.stringify(types)}`);\n      return;\n    }\n    return (\n      <div className={`${classPrefix}-table__filter-pop-content-inner`}>\n        <>\n          {filter.type === 'multiple' ? (\n            <Checkbox.Group\n              value={filterVal?.[colKey] || []}\n              defaultValue={[]}\n              onChange={(value) => {\n                onChangeFilter(value, colKey, column);\n              }}\n            >\n              {filter?.list.map(({ label, value }) => (\n                <Checkbox key={value} value={value}>\n                  {label}\n                </Checkbox>\n              ))}\n            </Checkbox.Group>\n          ) : null}\n\n          {filter.type === 'single' ? (\n            <Radio.Group\n              size=\"large\"\n              value={filterVal?.[colKey] || ''}\n              onChange={(value) => {\n                onChangeFilter(value, colKey, column);\n              }}\n            >\n              {filter?.list.map(({ label, value }) => (\n                <Radio key={value} value={value}>\n                  {label}\n                </Radio>\n              ))}\n            </Radio.Group>\n          ) : null}\n\n          {filter.type === 'input' ? (\n            <Input\n              placeholder=\"请输入内容（无默认值）\"\n              clearable\n              value={filterVal?.[colKey] || ''}\n              onChange={(value) => {\n                onChangeFilter(value, colKey, column);\n              }}\n            />\n          ) : null}\n        </>\n      </div>\n    );\n  };\n\n  function onChangeFilter(value: any, colKey: string, column: PrimaryTableCol<DataType>) {\n    setfilterVal({\n      ...filterVal,\n      [colKey]: value,\n    });\n    onChange({ ...filterVal, [colKey]: value }, column);\n  }\n\n  // 初始筛选条件变化，更新状态\n  useEffect(() => {\n    setfilterVal(innerfiltVal);\n  }, [innerfiltVal]);\n\n  return columns.map((column: PrimaryTableCol, index: number) => {\n    const { filter, colKey } = column;\n    if (!filter) {\n      return column;\n    }\n    const lastTitle = getTitle(column, index);\n    const titleNew = () => (\n      <div className={`${classPrefix}-table__cell--title`}>\n        <div>{lastTitle}</div>\n        <div className={classNames([`${classPrefix}-table__cell--filter`])}>\n          <Popup\n            trigger=\"click\"\n            placement=\"bottom\"\n            showArrow\n            overlayClassName={`${classPrefix}-table__filter-pop`}\n            content={\n              <div className={`${classPrefix}-table__filter-pop-content`}>\n                {getFilterContent(filter, colKey, column)}\n              </div>\n            }\n          >\n            {renderIcon(classPrefix, filterIcon)}\n          </Popup>\n        </div>\n      </div>\n    );\n    return {\n      ...column,\n      title: titleNew,\n    };\n  });\n}\n\nexport default FilterButton;\n"],"names":["renderIcon","classPrefix","icon","result","React","createElement","className","TIconFilter","getTitle","column","colIndex","isFunction","title","col","isString","FilterButton","props","onChange","filterIcon","innerfiltVal","columns","useContext","ConfigContext","useState","filterVal","setfilterVal","getFilterContent","filter","colKey","types","type","includes","console","error","JSON","stringify","Fragment","Checkbox","Group","value","defaultValue","onChangeFilter","list","map","label","key","Radio","size","Input","placeholder","clearable","useEffect","index","lastTitle","titleNew","classNames","Popup","trigger","placement","showArrow","overlayClassName","content"],"mappings":"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"}