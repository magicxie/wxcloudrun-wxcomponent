{"version":3,"file":"useFilter.js","sources":["../../../src/table/primary/useFilter.tsx"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react';\nimport { DataType, FilterValue, PrimaryTableCol } from '../type';\nimport { PrimaryTableProps } from '..';\nimport filterButton from './FilterButton';\n\n/**\n * 筛选hook\n * 1.返回加入筛选icon后的title\n * 2.返回筛选后的data\n */\nfunction useFilter(props: PrimaryTableProps): [PrimaryTableCol[], DataType[]] {\n  const { columns, filterIcon, filterValue, defaultFilterValue, onFilterChange, data } = props;\n  const isControlled = typeof filterValue !== 'undefined';\n  const [filterVal, setFilterVal] = useState<FilterValue>(defaultFilterValue);\n\n  useEffect(() => {\n    setFilterVal(isControlled ? filterValue : defaultFilterValue);\n  }, [filterValue, defaultFilterValue, isControlled]);\n\n  // 导出：筛选后的data。受控直接导出，非受控导出筛选数据\n  const transformedFilterData = useMemo<DataType[]>(() => {\n    if (isControlled) {\n      return data;\n    }\n    if (filterVal) {\n      let tmpData: DataType[] = data;\n      Object.keys(filterVal).forEach((k) => {\n        if (typeof filterVal?.[k] === 'string' || typeof filterVal?.[k] === 'number') {\n          tmpData = tmpData.filter((item) => item?.[k]?.toString().includes(filterVal?.[k].toString()));\n        }\n        if (Array.isArray(filterVal?.[k]) && (filterVal?.[k] as Array<string | number>).length > 0) {\n          tmpData = tmpData.filter((item) => (filterVal?.[k] as Array<string | number>).includes(item?.[k]));\n        }\n      });\n      return tmpData;\n    }\n    return data;\n  }, [data, filterVal, isControlled]);\n\n  // 导出：添加筛选图标后的columns\n  const transformedFilterColumns = filterButton({\n    columns,\n    onChange: onChangeFilterButton,\n    innerfiltVal: isControlled ? filterValue : defaultFilterValue,\n    filterIcon,\n  });\n\n  /**\n   * 触发筛选按钮，触发onFilterChange回调\n   * @param toast\n   * @param col\n   */\n  function onChangeFilterButton(toast, col: PrimaryTableCol) {\n    const newFilterVal: FilterValue = {\n      ...filterVal,\n      ...toast,\n    };\n    setFilterVal(newFilterVal);\n    if (onFilterChange) {\n      onFilterChange(newFilterVal, { col });\n    }\n  }\n\n  return [transformedFilterColumns, transformedFilterData];\n}\n\nexport default useFilter;\n"],"names":["useFilter","props","columns","filterIcon","filterValue","defaultFilterValue","onFilterChange","data","isControlled","useState","filterVal","setFilterVal","useEffect","transformedFilterData","useMemo","tmpData","Object","keys","forEach","k","filter","item","toString","includes","Array","isArray","length","transformedFilterColumns","filterButton","onChange","onChangeFilterButton","innerfiltVal","toast","col","newFilterVal"],"mappings":"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"}