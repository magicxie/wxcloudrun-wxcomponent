{"version":3,"file":"image-card.js","sources":["../../../src/upload/themes/image-card.tsx"],"sourcesContent":["import React, { FC, Fragment, useState } from 'react';\nimport { BrowseIcon, DeleteIcon, AddIcon } from 'tdesign-icons-react';\nimport Loading from '../../loading';\nimport Dialog from '../../dialog';\nimport useConfig from '../../_util/useConfig';\nimport { UploadRemoveContext } from '../type';\nimport { finishUpload } from '../util';\nimport { TdUploadFile } from '../types';\nimport BooleanRender from '../boolean-render';\n\nexport interface ImageCardProps {\n  files?: TdUploadFile[];\n  multiple?: boolean;\n  max?: number;\n  onTrigger: () => void;\n  onRemove?: (options: UploadRemoveContext) => void;\n  showUploadProgress: boolean;\n}\n\nconst ImageCard: FC<ImageCardProps> = (props) => {\n  const { files, multiple = false, max = 0, onRemove, showUploadProgress } = props;\n  const { classPrefix } = useConfig();\n  const [showImg, setShowImg] = useState(false);\n  const [imgURL, setImgURL] = useState();\n\n  const preview = (file) => {\n    setShowImg(true);\n    setImgURL(file.url);\n  };\n\n  const showTrigger = React.useMemo(() => {\n    if (multiple) {\n      return !max || files.length < max;\n    }\n\n    return !(files && files[0]);\n  }, [files, max, multiple]);\n\n  return (\n    <Fragment>\n      <Dialog\n        visible={showImg}\n        showOverlay\n        width=\"auto\"\n        top=\"10%\"\n        className={`${classPrefix}-upload__dialog`}\n        footer={false}\n        header={false}\n        onClose={() => {\n          setShowImg(false);\n          setImgURL(null);\n        }}\n      >\n        <p className={`${classPrefix}-dialog__dialog-body-img-box`}>\n          <img src={imgURL} alt=\"\" />\n        </p>\n      </Dialog>\n      <ul className={`${classPrefix}-upload__card`}>\n        <BooleanRender boolExpression={!!files}>\n          {files.map((file, index) => (\n            <li className={`${classPrefix}-upload__card-item ${classPrefix}-is--background`} key={index}>\n              <BooleanRender\n                falseRender={() => (\n                  <div className={`${classPrefix}-upload__card-content ${classPrefix}-upload__card-box`}>\n                    <img className={`${classPrefix}-upload__card-image`} src={file.url} />\n                    <div className={`${classPrefix}-upload__card-mask`}>\n                      <span className={`${classPrefix}-upload__card-mask-item`} onClick={(e) => e.stopPropagation()}>\n                        <BrowseIcon\n                          onClick={() => {\n                            preview(file);\n                          }}\n                        />\n                      </span>\n                      <span className={`${classPrefix}-upload__card-mask-item-divider`} />\n                      <span className={`${classPrefix}-upload__card-mask-item`} onClick={(e) => e.stopPropagation()}>\n                        <DeleteIcon\n                          onClick={(e) => {\n                            onRemove?.({ e, file, index });\n                          }}\n                        />\n                      </span>\n                    </div>\n                  </div>\n                )}\n                boolExpression={showUploadProgress && !finishUpload(file.status)}\n              >\n                <div className={`${classPrefix}-upload__card-container ${classPrefix}-upload__card-box`}>\n                  <Loading loading={true} size=\"medium\" />\n                  <p>上传中 {Math.min(files[0].percent, 99)}%</p>\n                </div>\n              </BooleanRender>\n            </li>\n          ))}\n        </BooleanRender>\n        <BooleanRender boolExpression={showTrigger}>\n          <li className={`${classPrefix}-upload__card-item ${classPrefix}-is--background`} onClick={props.onTrigger}>\n            <div className={`${classPrefix}-upload__card-container ${classPrefix}-upload__card-box`}>\n              <AddIcon />\n              <p className={`${classPrefix}-size-s`}>点击上传图片</p>\n            </div>\n          </li>\n        </BooleanRender>\n      </ul>\n    </Fragment>\n  );\n};\n\nexport default ImageCard;\n"],"names":["ImageCard","props","files","multiple","max","onRemove","showUploadProgress","useConfig","classPrefix","useState","showImg","setShowImg","imgURL","setImgURL","preview","file","url","showTrigger","React","useMemo","length","createElement","Fragment","Dialog","visible","showOverlay","width","top","className","footer","header","onClose","src","alt","BooleanRender","boolExpression","map","index","key","falseRender","onClick","e","stopPropagation","BrowseIcon","DeleteIcon","finishUpload","status","Loading","loading","size","Math","min","percent","onTrigger","AddIcon"],"mappings":"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"}