{"version":3,"file":"util.js","sources":["../../src/upload/util.ts"],"sourcesContent":["import { TdUploadFile } from './types';\n\nconst urlCreator = window.webkitURL || window.URL;\n\nexport function returnFileSize(number: number) {\n  if (number < 1024) {\n    return `${number} Bytes`;\n  }\n  if (number >= 1024 && number < 1048576) {\n    return `${(number / 1024).toFixed(1)} KB`;\n  }\n  if (number >= 1048576) {\n    return `${(number / 1048576).toFixed(1)} MB`;\n  }\n}\n\nexport function getCurrentDate() {\n  const d = new Date();\n  let month: string | number = d.getMonth() + 1;\n  month = month < 10 ? `0${month}` : month;\n  return `${d.getFullYear()}-${month}-${d.getDate()} ${d.getHours()}:${d.getMinutes()}:${d.getSeconds()}`;\n}\n/**\n * 缩略文件名 ABCDEFG => ABC...FG\n * @param inputName 文件名\n * @param leftCount 左边长度\n * @param rightcount 右边长度\n * @returns 缩略后的文件名\n */\nexport function abridgeName(inputName = '', leftCount = 5, rightcount = 7): string {\n  const name = inputName;\n  let leftLength = 0;\n  let rightLength = 0;\n  for (let i = 0; i < name.length; i++) {\n    const w = name[i];\n    const isCn = escape(w).indexOf('%u') === 0;\n    if (i < leftCount * 2 && leftLength < leftCount) {\n      isCn ? (leftLength += 1) : (leftLength += 2);\n    } else if (i > i - rightcount && rightLength < rightcount) {\n      isCn ? (rightLength += 1) : (rightLength += 2);\n    }\n  }\n  return name.replace(new RegExp(`^(.{${leftLength}})(.+)(.{${rightLength}})$`), '$1…$3');\n}\n\nexport function updateFileList(file: TdUploadFile, fileList: TdUploadFile[]) {\n  const nextFileList = [...fileList];\n  const fileIndex = nextFileList.findIndex(({ uid }: TdUploadFile) => uid === file.uid);\n  if (fileIndex === -1) {\n    nextFileList.push(file);\n  } else {\n    nextFileList[fileIndex] = file;\n  }\n\n  return nextFileList;\n}\n\nexport function createFileURL(file: File) {\n  return urlCreator.createObjectURL(file);\n}\n\nexport function finishUpload(state) {\n  return ['success', 'fail'].includes(state);\n}\n\nexport function isSingleFile(multiple = false, theme: string) {\n  return !multiple && ['file', 'file-input', 'image'].includes(theme);\n}\n"],"names":["urlCreator","window","webkitURL","URL","returnFileSize","number","toFixed","getCurrentDate","d","Date","month","getMonth","getFullYear","getDate","getHours","getMinutes","getSeconds","abridgeName","inputName","leftCount","rightcount","name","leftLength","rightLength","i","length","w","isCn","escape","indexOf","replace","RegExp","updateFileList","file","fileList","nextFileList","fileIndex","findIndex","uid","push","createFileURL","createObjectURL","finishUpload","state","includes","isSingleFile","multiple","theme"],"mappings":"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"}