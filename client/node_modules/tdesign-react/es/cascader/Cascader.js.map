{"version":3,"file":"Cascader.js","sources":["../../src/cascader/Cascader.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo } from 'react';\n\n// component\nimport { useLocaleReceiver } from '../locale/LocalReceiver';\nimport Panel from './components/Panel';\nimport Popup from '../popup';\nimport InputContent from './components/InputContent';\n\n// utils\nimport useConfig from '../_util/useConfig';\nimport TreeStore from '../_common/js/tree/tree-store';\nimport useDefault from '../_util/useDefault';\nimport { getTreeValue } from './utils/helper';\n\n// common logic\nimport { treeNodesEffect, treeStoreExpendEffect } from './utils/cascader';\n\n// types\nimport { CascaderProps, CascaderContextType, TreeNodeValue, TreeNodeModel } from './interface';\nimport { CascaderChangeSource, CascaderValue } from './type';\n\nconst Cascader: React.FC<CascaderProps> = (props) => {\n  /**\n   * global user props, config, data\n   */\n  const { classPrefix } = useConfig();\n  const name = `${classPrefix}-cascader`;\n  const { className, style, defaultValue, onChange, collapsedItems } = props;\n\n  const [value, setValue] = useDefault(props.value, defaultValue, onChange);\n\n  const [visible, setVisible] = useState(false);\n  const [treeStore, setTreeStore] = useState(null);\n  const [filterActive, setFilterActive] = useState(false);\n  const [inputVal, setInputVal] = useState('');\n  const [inputWidth, setInputWidth] = useState(0);\n  const [treeNodes, setTreeNodes] = useState([]);\n  const [expend, setExpend] = useState<TreeNodeValue[]>([]);\n\n  // cascaderContext, center status\n  const cascaderContext = useMemo(() => {\n    const {\n      size = 'medium',\n      disabled = false,\n      checkStrictly = false,\n      lazy = true,\n      multiple = false,\n      filterable = false,\n      clearable = false,\n      checkProps = {},\n      max = 0,\n      showAllLevels = true,\n      minCollapsedNum = false,\n    } = props;\n    return {\n      size,\n      disabled,\n      checkStrictly,\n      lazy,\n      multiple,\n      filterable,\n      value,\n      setValue: (val: CascaderValue, source: CascaderChangeSource, node?: TreeNodeModel) => {\n        setValue(val, {\n          source,\n          node,\n        });\n      },\n      visible,\n      setVisible,\n      treeStore,\n      checkProps,\n      clearable,\n      showAllLevels,\n      max,\n      treeNodes,\n      setTreeNodes,\n      filterActive,\n      setFilterActive,\n      inputVal,\n      setInputVal,\n      setExpend,\n      minCollapsedNum,\n      inputWidth,\n      setInputWidth,\n    } as CascaderContextType;\n  }, [props, inputVal, value, setValue, visible, treeStore, treeNodes, filterActive, inputWidth, setInputWidth]);\n\n  /**\n   * build tree\n   */\n  const { disabled, options = [], keys, checkStrictly = false, lazy = true, load, valueMode = 'onlyLeaf' } = props;\n\n  const createStore = (onLoad: () => void) => {\n    const treeProps = {\n      keys: keys || {},\n      checkable: true,\n      checkStrictly,\n      expandMutex: true,\n      expandParent: true,\n      disabled,\n      load,\n      lazy,\n      valueMode,\n      onLoad,\n    };\n    const store = new TreeStore(treeProps);\n\n    store.append(options);\n    return store;\n  };\n\n  if (!treeStore) {\n    const store = createStore(() => {\n      setTimeout(() => {\n        store.refreshNodes();\n        treeNodesEffect(inputVal, store, setTreeNodes);\n      }, 0);\n    });\n    setTreeStore(store);\n  }\n\n  useEffect(() => {\n    const treeProps = {\n      keys: keys || {},\n      checkable: true,\n      checkStrictly,\n      expandMutex: true,\n      expandParent: true,\n      disabled,\n      load,\n      lazy,\n      valueMode,\n      options,\n    };\n    treeStore.setConfig(treeProps);\n  }, [checkStrictly, disabled, keys, lazy, load, options, valueMode, treeStore]);\n\n  // treeStore and expend effect\n  useEffect(() => {\n    if (!treeStore) return;\n    treeStoreExpendEffect(treeStore, value, expend);\n  }, [treeStore, value, expend]);\n\n  // value change will effect treeNodes, in filter, inputVal will also change treeNodes\n  useEffect(() => {\n    if (!treeStore) return;\n    treeNodesEffect(inputVal, treeStore, setTreeNodes);\n  }, [inputVal, treeStore, value]);\n\n  // tree checked effect\n  useEffect(() => {\n    if (!treeStore) return;\n    treeStore.replaceChecked(getTreeValue(value));\n  }, [value, treeStore]);\n\n  useEffect(() => {\n    if (!filterActive) {\n      setInputVal('');\n    }\n  }, [filterActive]);\n\n  const [local, t] = useLocaleReceiver('cascader');\n\n  // panel props\n  const { empty = t(local.empty), trigger = 'click' } = props;\n\n  // inputContent props\n  const { placeholder = '请输入', onRemove, onBlur, onFocus } = props;\n\n  return (\n    <Popup\n      className={`${name}__popup`}\n      placement=\"bottom-left\"\n      visible={visible}\n      overlayClassName={`${name}__dropdown`}\n      expandAnimation={true}\n      destroyOnClose={true}\n      {...props?.popupProps}\n      content={<Panel cascaderContext={cascaderContext} trigger={trigger} onChange={onChange} empty={empty} />}\n    >\n      <InputContent\n        collapsedItems={collapsedItems}\n        cascaderContext={cascaderContext}\n        style={style}\n        className={className}\n        listeners={{\n          onRemove,\n          onBlur,\n          onFocus,\n          onChange,\n        }}\n        placeholder={placeholder}\n      />\n      {/* TODO popup need a node */}\n      <></>\n    </Popup>\n  );\n};\n\nexport default Cascader;\n"],"names":["Cascader","props","useConfig","classPrefix","name","className","style","defaultValue","onChange","collapsedItems","useDefault","value","setValue","useState","visible","setVisible","treeStore","setTreeStore","filterActive","setFilterActive","inputVal","setInputVal","inputWidth","setInputWidth","treeNodes","setTreeNodes","expend","setExpend","cascaderContext","useMemo","size","disabled","disabled2","checkStrictly","checkStrictly2","lazy","lazy2","multiple","filterable","clearable","checkProps","max","showAllLevels","minCollapsedNum","val","source","node","options","keys","load","valueMode","createStore","onLoad","treeProps","checkable","expandMutex","expandParent","store","TreeStore","append","setTimeout","refreshNodes","treeNodesEffect","useEffect","setConfig","treeStoreExpendEffect","replaceChecked","getTreeValue","useLocaleReceiver","local","t","empty","trigger","placeholder","onRemove","onBlur","onFocus","React","createElement","Popup","placement","overlayClassName","expandAnimation","destroyOnClose","popupProps","content","Panel","InputContent","listeners","Fragment"],"mappings":"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"}