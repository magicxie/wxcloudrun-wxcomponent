/**
 * tdesign v0.22.1
 * (c) 2022 tdesign
 * @license MIT
 */

import { _ as _slicedToArray } from '../_chunks/dep-93971e86.js';
import { _ as _defineProperty } from '../_chunks/dep-9332bbea.js';
import React, { useRef, useImperativeHandle } from 'react';
import classNames from 'classnames';
import { i as isEmpty_1 } from '../_chunks/dep-a8d92bd9.js';
import { i as isFunction_1 } from '../_chunks/dep-25536592.js';
import { f as flatten_1 } from '../_chunks/dep-66dcd197.js';
import useConfig from '../_util/useConfig.js';
import noop from '../_util/noop.js';
import forwardRefWithStatics from '../_util/forwardRefWithStatics.js';
import FormContext from './FormContext.js';
import FormItem from './FormItem.js';
import '../_chunks/dep-beac373a.js';
import '../_chunks/dep-ab1e2688.js';
import '../_chunks/dep-39f90ded.js';
import '../_chunks/dep-aa2bff1b.js';
import '../_chunks/dep-156c830d.js';
import '../_chunks/dep-14692160.js';
import '../_chunks/dep-312619d6.js';
import '../_chunks/dep-55e3e3e3.js';
import '../_chunks/dep-7daf07a9.js';
import '../_chunks/dep-e2a0e7b2.js';
import '../_chunks/dep-5ace74d6.js';
import '../_chunks/dep-8309e373.js';
import '../_chunks/dep-a764e3bd.js';
import '../_chunks/dep-d098d908.js';
import '../_chunks/dep-f5f7d3f4.js';
import '../_chunks/dep-897ce04d.js';
import '../_chunks/dep-2eff142e.js';
import '../_chunks/dep-b8263a1c.js';
import '../_chunks/dep-1997c424.js';
import '../_chunks/dep-14bd2526.js';
import '../config-provider/ConfigContext.js';
import '../locale/zh_CN.js';
import 'hoist-non-react-statics';
import 'tdesign-icons-react';
import '../checkbox/index.js';
import '../_chunks/dep-d44ac8a4.js';
import '../common/Check.js';
import '../_chunks/dep-27d690ce.js';
import '../_util/helper.js';
import '../_chunks/dep-93bd2d05.js';
import '../_chunks/dep-44c00646.js';
import '../_chunks/dep-95c9ff5b.js';
import '../_chunks/dep-304ab091.js';
import '../_chunks/dep-ea69dcf8.js';
import '../_util/useDefault.js';
import '../_chunks/dep-d2535fd6.js';
import './style/css.js';
import '../checkbox/type.js';
import '../upload/index.js';
import '../upload/upload.js';
import '../_chunks/dep-124f91c5.js';
import '../_chunks/dep-121f2926.js';
import '../_chunks/dep-444d31ef.js';
import '../_chunks/dep-a0400c35.js';
import '../_chunks/dep-0de37580.js';
import '../_chunks/dep-0758224e.js';
import '../_chunks/dep-f88db21e.js';
import '../_chunks/dep-ae2e9ece.js';
import '../_chunks/dep-0ce610a9.js';
import '../_chunks/dep-8bccb9b0.js';
import '../_chunks/dep-028895a6.js';
import '../_chunks/dep-cac5f189.js';
import '../dialog/index.js';
import '../dialog/Dialog.js';
import '../_chunks/dep-3853103d.js';
import '../locale/LocalReceiver.js';
import '../config-provider/index.js';
import '../config-provider/ConfigProvider.js';
import '../button/index.js';
import '../button/Button.js';
import '../_util/useRipple.js';
import '../_util/setStyle.js';
import '../loading/index.js';
import '../loading/loading.js';
import '../_util/dom.js';
import 'raf';
import '../_util/easing.js';
import '../common/Portal.js';
import 'react-dom';
import '../loading/gradient.js';
import '../loading/type.js';
import '../loading/plugin.js';
import '../button/type.js';
import '../dialog/RenderDialog.js';
import 'react-transition-group';
import '../_util/useSetState.js';
import '../dialog/type.js';
import '../dialog/plugin.js';
import '../upload/dragger.js';
import '../upload/themes/dragger-progress.js';
import '../upload/util.js';
import '../upload/upload-trigger.js';
import '../upload/tips.js';
import '../_common/js/upload/xhr.js';
import '../upload/themes/single-file.js';
import '../upload/themes/image-card.js';
import '../upload/boolean-render.js';
import '../upload/themes/flow-list/index.js';
import '../upload/themes/flow-list/img-list.js';
import '../upload/themes/flow-list/file-list.js';
import '../upload/hooks/useDefaultValue.js';
import '../upload/type.js';
import '../tag/index.js';
import '../tag/Tag.js';
import '../tag/CheckTag.js';
import '../tag/type.js';
import './formModel.js';

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
var Form = forwardRefWithStatics(function (props, ref) {
  var style = props.style,
      className = props.className,
      _props$labelWidth = props.labelWidth,
      labelWidth = _props$labelWidth === void 0 ? "100px" : _props$labelWidth,
      statusIcon = props.statusIcon,
      _props$labelAlign = props.labelAlign,
      labelAlign = _props$labelAlign === void 0 ? "right" : _props$labelAlign,
      _props$layout = props.layout,
      layout = _props$layout === void 0 ? "vertical" : _props$layout,
      _props$size = props.size,
      size = _props$size === void 0 ? "medium" : _props$size,
      _props$colon = props.colon,
      colon = _props$colon === void 0 ? false : _props$colon,
      _props$requiredMark = props.requiredMark,
      requiredMark = _props$requiredMark === void 0 ? true : _props$requiredMark,
      scrollToFirstError = props.scrollToFirstError,
      _props$showErrorMessa = props.showErrorMessage,
      showErrorMessage = _props$showErrorMessa === void 0 ? true : _props$showErrorMessa,
      _props$resetType = props.resetType,
      resetType = _props$resetType === void 0 ? "empty" : _props$resetType,
      rules = props.rules,
      children = props.children,
      onSubmit = props.onSubmit,
      onReset = props.onReset,
      _props$onValuesChange = props.onValuesChange,
      onValuesChange = _props$onValuesChange === void 0 ? noop : _props$onValuesChange;

  var _useConfig = useConfig(),
      classPrefix = _useConfig.classPrefix;

  var formClass = classNames(className, "".concat(classPrefix, "-form"), _defineProperty({}, "".concat(classPrefix, "-form-inline"), layout === "inline"));
  var formItemsRef = useRef([]);
  var FORM_ITEM_CLASS_PREFIX = "".concat(classPrefix, "-form-item__");

  function getFirstError(r) {
    var _r$firstKey$;

    if (r === true) return;

    var _Object$keys = Object.keys(r),
        _Object$keys2 = _slicedToArray(_Object$keys, 1),
        firstKey = _Object$keys2[0];

    if (scrollToFirstError) {
      scrollTo(".".concat(FORM_ITEM_CLASS_PREFIX + firstKey));
    }

    return (_r$firstKey$ = r[firstKey][0]) === null || _r$firstKey$ === void 0 ? void 0 : _r$firstKey$.message;
  }

  function scrollTo(selector) {
    var dom = document.querySelector(selector);
    var behavior = scrollToFirstError;
    dom && dom.scrollIntoView({
      behavior: behavior
    });
  }

  function submitHandler(e) {
    e === null || e === void 0 ? void 0 : e.preventDefault();
    validate().then(function (r) {
      getFirstError(r);
      onSubmit === null || onSubmit === void 0 ? void 0 : onSubmit({
        validateResult: r,
        e: e
      });
    });
  }

  function resetHandler(e) {
    e === null || e === void 0 ? void 0 : e.preventDefault();
    formItemsRef.current.forEach(function (_ref) {
      var formItemRef = _ref.current;
      if (!isFunction_1(formItemRef.resetField)) return;
      formItemRef.resetField();
    });
    onReset === null || onReset === void 0 ? void 0 : onReset({
      e: e
    });
  }

  function validate(param) {
    function needValidate(name, fields2) {
      if (!fields2 || !Array.isArray(fields2)) return true;
      return fields2.indexOf(name) !== -1;
    }

    var _ref2 = param || {},
        fields = _ref2.fields,
        _ref2$trigger = _ref2.trigger,
        trigger = _ref2$trigger === void 0 ? "all" : _ref2$trigger;

    var list = formItemsRef.current.filter(function (_ref3) {
      var formItemRef = _ref3.current;
      return isFunction_1(formItemRef.validate) && needValidate(formItemRef.name, fields);
    }).map(function (_ref4) {
      var formItemRef = _ref4.current;
      return formItemRef.validate(trigger);
    });
    return new Promise(function (resolve) {
      Promise.all(flatten_1(list)).then(function (arr) {
        var r = arr.reduce(function (r2, err) {
          return Object.assign(r2 || {}, err);
        }, {});
        Object.keys(r).forEach(function (key) {
          if (r[key] === true) {
            delete r[key];
          }
        });
        resolve(isEmpty_1(r) ? true : r);
      })["catch"](console.error);
    });
  }

  function getAllFieldsValue() {
    var fieldsValue = {};
    formItemsRef.current.forEach(function (_ref5) {
      var formItemRef = _ref5.current;

      if (formItemRef.name) {
        fieldsValue[formItemRef.name] = formItemRef.value;
      }
    });
    return fieldsValue;
  }

  function getFieldValue(name) {
    if (!name) return null;
    var target = formItemsRef.current.find(function (_ref6) {
      var formItemRef = _ref6.current;
      return formItemRef.name === name;
    });
    return target && target.value;
  }

  function setFieldsValue() {
    var fileds = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    var formItemsMap = formItemsRef.current.reduce(function (acc, _ref7) {
      var currItem = _ref7.current;
      var name = currItem.name;
      return _objectSpread(_objectSpread({}, acc), {}, _defineProperty({}, name, currItem));
    }, {});
    Object.keys(fileds).forEach(function (key) {
      var _formItemsMap$key;

      (_formItemsMap$key = formItemsMap[key]) === null || _formItemsMap$key === void 0 ? void 0 : _formItemsMap$key.setValue(fileds[key]);
    });
  }

  function setFields() {
    var fileds = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
    if (!Array.isArray(fileds)) throw new Error("setFields \u53C2\u6570\u9700\u8981 Array \u7C7B\u578B");
    var formItemsMap = formItemsRef.current.reduce(function (acc, _ref8) {
      var currItem = _ref8.current;
      var name = currItem.name;
      return _objectSpread(_objectSpread({}, acc), {}, _defineProperty({}, name, currItem));
    }, {});
    fileds.forEach(function (filed) {
      var _formItemsMap$name;

      var name = filed.name,
          value = filed.value,
          status = filed.status;
      (_formItemsMap$name = formItemsMap[name]) === null || _formItemsMap$name === void 0 ? void 0 : _formItemsMap$name.setField({
        value: value,
        status: status
      });
    });
  }

  useImperativeHandle(ref, function () {
    return {
      submit: submitHandler,
      reset: resetHandler,
      getFieldValue: getFieldValue,
      setFieldsValue: setFieldsValue,
      setFields: setFields,
      validate: validate,
      getAllFieldsValue: getAllFieldsValue
    };
  });

  function onFormItemValueChange(changedValue) {
    var allFileds = getAllFieldsValue();
    onValuesChange(changedValue, allFileds);
  }

  return /* @__PURE__ */React.createElement(FormContext.Provider, {
    value: {
      labelWidth: labelWidth,
      statusIcon: statusIcon,
      labelAlign: labelAlign,
      layout: layout,
      size: size,
      colon: colon,
      requiredMark: requiredMark,
      showErrorMessage: showErrorMessage,
      scrollToFirstError: scrollToFirstError,
      resetType: resetType,
      rules: rules,
      formItemsRef: formItemsRef,
      onFormItemValueChange: onFormItemValueChange
    }
  }, /* @__PURE__ */React.createElement("form", {
    className: formClass,
    style: style,
    onSubmit: submitHandler,
    onReset: resetHandler,
    ref: ref
  }, children));
}, {
  FormItem: FormItem
});
Form.displayName = "Form";

export { Form as default };
//# sourceMappingURL=Form.js.map
