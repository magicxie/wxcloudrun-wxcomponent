{"version":3,"file":"FormItem.js","sources":["../../node_modules/lodash/isNil.js","../../src/form/FormItem.tsx"],"sourcesContent":["/**\n * Checks if `value` is `null` or `undefined`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is nullish, else `false`.\n * @example\n *\n * _.isNil(null);\n * // => true\n *\n * _.isNil(void 0);\n * // => true\n *\n * _.isNil(NaN);\n * // => false\n */\nfunction isNil(value) {\n  return value == null;\n}\n\nmodule.exports = isNil;\n","import React, { forwardRef, ReactNode, useState, useImperativeHandle, useEffect, useRef } from 'react';\nimport classNames from 'classnames';\nimport isNil from 'lodash/isNil';\nimport { CheckCircleFilledIcon, CloseCircleFilledIcon, ErrorCircleFilledIcon } from 'tdesign-icons-react';\nimport useConfig from '../_util/useConfig';\nimport { TdFormItemProps, ValueType, FormRule } from './type';\nimport Checkbox from '../checkbox';\nimport Upload from '../upload';\nimport Tag from '../tag';\nimport { StyledProps } from '../common';\nimport { validate as validateModal, isValueEmpty } from './formModel';\nimport { useFormContext } from './FormContext';\n\nenum ValidateStatus {\n  TO_BE_VALIDATED = 'not',\n  SUCCESS = 'success',\n  FAIL = 'fail',\n}\nexport interface FormItemProps extends TdFormItemProps, StyledProps {\n  // 子节点\n  children?: React.ReactNode;\n}\n\nconst ctrlKeyMap = new Map();\nctrlKeyMap.set(Checkbox, 'checked');\nctrlKeyMap.set(Tag.CheckTag, 'checked');\nctrlKeyMap.set(Upload, 'file');\n\nconst FormItem = forwardRef<HTMLDivElement, FormItemProps>((props, ref) => {\n  const { classPrefix } = useConfig();\n  const {\n    children,\n    label,\n    name,\n    help,\n    statusIcon: statusIconFromProp,\n    rules: rulesFromProp,\n    labelWidth,\n    labelAlign,\n    initialData,\n    className,\n    style: formItemStyle,\n  } = props;\n  const {\n    colon,\n    requiredMark,\n    layout,\n    labelAlign: labelAlignFromContext,\n    labelWidth: labelWidthFromContext,\n    showErrorMessage,\n    resetType,\n    rules: rulesFromContext,\n    statusIcon: statusIconFromContext,\n    formItemsRef,\n    onFormItemValueChange,\n  } = useFormContext();\n\n  const [errorList, setErrorList] = useState([]);\n  const [successList, setSuccessList] = useState([]);\n  const [verifyStatus, setVerifyStatus] = useState(ValidateStatus.TO_BE_VALIDATED);\n  const [resetValidating, setResetValidating] = useState(false);\n  const [needResetField, setNeedResetField] = useState(false);\n  const [formValue, setFormValue] = useState(initialData);\n\n  const currentFormItemRef = useRef();\n  const innerFormItemsRef = useRef([]);\n  const shouldValidate = useRef(null);\n  const isMounted = useRef(false);\n\n  const innerRules: FormRule[] = (rulesFromContext && rulesFromContext[name]) || rulesFromProp || [];\n  const innerLabelWidth = isNil(labelWidth) ? labelWidthFromContext : labelWidth;\n  const innerLabelAlign = isNil(labelAlign) ? labelAlignFromContext : labelAlign;\n\n  const formItemClass = classNames(className, `${classPrefix}-form__item`, {\n    [`${classPrefix}-form-item__${name}`]: name,\n    [`${classPrefix}-form__item-with-help`]: help,\n    [`${classPrefix}-form__item-with-extra`]: renderTipsInfo(),\n  });\n  const formItemLabelClass = classNames(`${classPrefix}-form__label`, {\n    [`${classPrefix}-form__label--required`]:\n      requiredMark && innerRules.filter((rule: any) => rule.required).length > 0,\n    [`${classPrefix}-form__label--colon`]: colon && label,\n    [`${classPrefix}-form__label--top`]: innerLabelAlign === 'top' || !innerLabelWidth,\n    [`${classPrefix}-form__label--left`]: innerLabelAlign === 'left' && innerLabelWidth,\n    [`${classPrefix}-form__label--right`]: innerLabelAlign === 'right' && innerLabelWidth,\n  });\n\n  const contentClasses = classNames(`${classPrefix}-form__controls`, {\n    [`${classPrefix}-is-success`]: showErrorMessage && verifyStatus === ValidateStatus.SUCCESS,\n    [`${classPrefix}-is-warning`]: showErrorMessage && errorList.length && errorList[0].type === 'warning',\n    [`${classPrefix}-is-error`]: showErrorMessage && errorList.length && errorList[0].type === 'error',\n  });\n\n  let labelStyle = {};\n  let contentStyle = {};\n  if (innerLabelWidth && innerLabelAlign !== 'top') {\n    if (typeof innerLabelWidth === 'number') {\n      labelStyle = { width: `${innerLabelWidth}px` };\n      contentStyle = { marginLeft: layout !== 'inline' ? `${innerLabelWidth}px` : '' };\n    } else {\n      labelStyle = { width: innerLabelWidth };\n      contentStyle = { marginLeft: layout !== 'inline' ? innerLabelWidth : '' };\n    }\n  }\n\n  function renderTipsInfo() {\n    let helpNode = null;\n    if (help) helpNode = <div className={`${classPrefix}-form__help`}>{help}</div>;\n\n    if (showErrorMessage && errorList.length && errorList[0].message) {\n      return <p className={`${classPrefix}-input__extra`}>{errorList[0].message}</p>;\n    }\n    if (successList.length) {\n      return <p className={`${classPrefix}-input__extra`}>{successList[0].message}</p>;\n    }\n\n    return helpNode;\n  }\n\n  const renderSuffixIcon = () => {\n    if (statusIconFromProp === false) return null;\n\n    const resultIcon = (iconSlot: ReactNode) => <span className={`${classPrefix}-form__status`}>{iconSlot}</span>;\n\n    const getDefaultIcon = () => {\n      const iconMap = {\n        success: <CheckCircleFilledIcon size=\"25px\" />,\n        error: <CloseCircleFilledIcon size=\"25px\" />,\n        warning: <ErrorCircleFilledIcon size=\"25px\" />,\n      };\n      if (verifyStatus === ValidateStatus.SUCCESS) {\n        return resultIcon(iconMap[verifyStatus]);\n      }\n      if (errorList && errorList[0]) {\n        const type = errorList[0].type || 'error';\n        return resultIcon(iconMap[type]);\n      }\n      return null;\n    };\n\n    if (React.isValidElement(statusIconFromProp)) {\n      return resultIcon(\n        React.cloneElement(statusIconFromProp, { style: { color: 'unset' }, ...statusIconFromProp.props }),\n      );\n    }\n    if (statusIconFromContext === true) {\n      return getDefaultIcon();\n    }\n    if (React.isValidElement(statusIconFromContext)) {\n      return resultIcon(statusIconFromProp);\n    }\n\n    return null;\n  };\n\n  function validate(trigger) {\n    if (innerFormItemsRef.current.length) {\n      return innerFormItemsRef.current.map((innerFormItem) => innerFormItem?.validate());\n    }\n    // 过滤不需要校验的规则\n    const rules = trigger === 'all' ? innerRules : innerRules.filter((item) => (item.trigger || 'change') === trigger);\n    setResetValidating(true);\n    // 校验结果，包含正确的校验信息\n    return new Promise((resolve) => {\n      validateModal(formValue, rules).then((r) => {\n        const filterErrorList = r.filter((item) => item.result !== true);\n        setErrorList(filterErrorList);\n        // 仅有自定义校验方法才会存在 successList\n        setSuccessList(r.filter((item) => item.result === true && item.message && item.type === 'success'));\n        let nextVerifyStatus = filterErrorList.length && rules.length ? ValidateStatus.FAIL : ValidateStatus.SUCCESS;\n        // 非 require 且值为空 状态置为默认，无校验规则的都为默认\n        if ((!rules.some((rule) => rule.required) && isValueEmpty(formValue)) || !rules.length) {\n          nextVerifyStatus = ValidateStatus.TO_BE_VALIDATED;\n        }\n        setVerifyStatus(nextVerifyStatus);\n        needResetField && resetHandler();\n        setResetValidating(false);\n\n        resolve({ [name]: !filterErrorList.length ? true : r });\n      });\n    });\n  }\n\n  // blur 下触发校验\n  function handleItemBlur() {\n    const filterRules = innerRules.filter((item) => item.trigger === 'blur');\n\n    filterRules.length && validate('blur');\n  }\n\n  function getEmptyValue(): ValueType {\n    const type = Object.prototype.toString.call(initialData);\n    let emptyValue: ValueType = '';\n    if (type === '[object Array]') {\n      emptyValue = [];\n    }\n    if (type === '[object Object]') {\n      emptyValue = {};\n    }\n    return emptyValue;\n  }\n\n  function resetField() {\n    if (!name) return;\n    if (resetType === 'empty') {\n      setFormValue(getEmptyValue());\n    }\n    if (resetType === 'initial') {\n      setFormValue(initialData);\n    }\n\n    if (resetValidating) {\n      setNeedResetField(true);\n    } else {\n      resetHandler();\n    }\n  }\n\n  function resetHandler() {\n    shouldValidate.current = false;\n    setNeedResetField(false);\n    setErrorList([]);\n    setSuccessList([]);\n    setVerifyStatus(ValidateStatus.TO_BE_VALIDATED);\n  }\n\n  function setField(field: { value?: string; status?: ValidateStatus }) {\n    const { value, status } = field;\n    // 手动设置 status 则不需要校验 交给用户判断\n    if (typeof status !== 'undefined') {\n      shouldValidate.current = false;\n      setErrorList([]);\n      setSuccessList([]);\n      setNeedResetField(false);\n      setVerifyStatus(status);\n    }\n    if (typeof value !== 'undefined') {\n      setFormValue(value);\n    }\n  }\n\n  useEffect(() => {\n    // value change event\n    if (isMounted.current) {\n      if (!name) console.warn('FormItem prop name is required.');\n      name && onFormItemValueChange({ [name]: formValue });\n    }\n\n    // 首次渲染不触发校验 后续判断是否检验也通过此字段控制\n    if (!shouldValidate.current || !isMounted.current) {\n      isMounted.current = true;\n      shouldValidate.current = true;\n      return;\n    }\n\n    const filterRules = innerRules.filter((item) => (item.trigger || 'change') === 'change');\n\n    filterRules.length && validate('change');\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [formValue]);\n\n  useEffect(() => {\n    formItemsRef.current.push(currentFormItemRef);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // 暴露 ref 实例方法\n  useImperativeHandle(currentFormItemRef, (): any => ({\n    name,\n    value: formValue,\n    setValue: setFormValue,\n    setField,\n    validate,\n    resetField,\n  }));\n\n  return (\n    <div className={formItemClass} style={formItemStyle} ref={ref}>\n      {label && (\n        <div className={formItemLabelClass} style={labelStyle}>\n          <label htmlFor={props?.for}>{label}</label>\n        </div>\n      )}\n      <div className={contentClasses} style={contentStyle}>\n        <div className={`${classPrefix}-form__controls-content`}>\n          {React.Children.map(children, (child, index) => {\n            if (!child) return null;\n\n            let onChangeFromProps = () => ({});\n            let onBlurFromProps = () => ({});\n            let ctrlKey = 'value';\n            if (React.isValidElement(child)) {\n              if (child.type === FormItem) {\n                return React.cloneElement(child, {\n                  ref: (el) => {\n                    if (!el) return;\n                    innerFormItemsRef.current[index] = el;\n                  },\n                });\n              }\n              if (typeof child.props.onChange === 'function') {\n                onChangeFromProps = child.props.onChange;\n              }\n              if (typeof child.props.onBlur === 'function') {\n                onBlurFromProps = child.props.onBlur;\n              }\n              if (typeof child.type === 'object') {\n                ctrlKey = ctrlKeyMap.get(child.type) || 'value';\n              }\n              return React.cloneElement(child, {\n                ...child.props,\n                [ctrlKey]: formValue,\n                onChange: (value) => {\n                  onChangeFromProps.call(null, value);\n                  setFormValue(value);\n                },\n                onBlur: (value) => {\n                  onBlurFromProps.call(null, value);\n                  handleItemBlur();\n                },\n              });\n            }\n            return child;\n          })}\n          {renderSuffixIcon()}\n        </div>\n        {renderTipsInfo()}\n      </div>\n    </div>\n  );\n});\n\nexport default FormItem;\n"],"names":["isNil","value","isNil_1","ValidateStatus","ValidateStatus2","ctrlKeyMap","Map","set","Checkbox","Tag","CheckTag","Upload","FormItem","forwardRef","props","ref","useConfig","classPrefix","children","label","name","help","statusIconFromProp","statusIcon","rulesFromProp","rules","labelWidth","labelAlign","initialData","className","formItemStyle","style","useFormContext","colon","requiredMark","layout","labelAlignFromContext","labelWidthFromContext","showErrorMessage","resetType","rulesFromContext","statusIconFromContext","formItemsRef","onFormItemValueChange","useState","errorList","setErrorList","successList","setSuccessList","verifyStatus","setVerifyStatus","resetValidating","setResetValidating","needResetField","setNeedResetField","formValue","setFormValue","currentFormItemRef","useRef","innerFormItemsRef","shouldValidate","isMounted","innerRules","innerLabelWidth","innerLabelAlign","formItemClass","classNames","renderTipsInfo","formItemLabelClass","filter","rule","required","length","contentClasses","type","labelStyle","contentStyle","width","marginLeft","helpNode","React","createElement","message","renderSuffixIcon","resultIcon","iconSlot","getDefaultIcon","iconMap","success","CheckCircleFilledIcon","size","error","CloseCircleFilledIcon","warning","ErrorCircleFilledIcon","isValidElement","cloneElement","color","validate","trigger","current","map","innerFormItem","item","Promise","resolve","validateModal","then","r","filterErrorList","result","nextVerifyStatus","some","isValueEmpty","resetHandler","handleItemBlur","filterRules","getEmptyValue","Object","prototype","toString","call","emptyValue","resetField","setField","field","status","useEffect","console","warn","push","useImperativeHandle","setValue","htmlFor","Children","child","index","onChangeFromProps","onBlurFromProps","ctrlKey","el","onChange","onBlur","get"],"mappings":"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"}