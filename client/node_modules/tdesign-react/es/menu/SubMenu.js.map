{"version":3,"file":"SubMenu.js","sources":["../../src/menu/SubMenu.tsx"],"sourcesContent":["import React, { FC, useContext, useState, ReactElement, useMemo, useRef } from 'react';\nimport classNames from 'classnames';\nimport { StyledProps } from '../common';\nimport { TdSubmenuProps } from './type';\nimport useConfig from '../_util/useConfig';\nimport { MenuContext } from './MenuContext';\nimport useRipple from '../_util/useRipple';\nimport { getSubMenuMaxHeight } from './_util/getSubMenuChildStyle';\nimport checkSubMenuChildrenActive from './_util/checkSubMenuChildrenActive';\nimport FakeArrow from '../common/FakeArrow';\nimport { checkIsSubMenu } from './_util/checkMenuType';\nimport { cacularPaddingLeft } from './_util/cacularPaddingLeft';\n\nexport interface SubMenuProps extends TdSubmenuProps, StyledProps {}\n\nexport interface SubMenuWithCustomizeProps extends SubMenuProps {\n  level?: number;\n}\n\nconst SubAccordion: FC<SubMenuWithCustomizeProps> = (props) => {\n  const { content, children = content, disabled, icon, title, value, className, style, level = 1 } = props;\n  const { classPrefix } = useConfig();\n\n  // popup 状态下控制开关\n  const [open, setOpen] = useState(false);\n  const { expanded = [], onExpand, active, expandType } = useContext(MenuContext);\n\n  const isPopUp = expandType === 'popup';\n  // 非 popup 展开\n  const isExpand = expanded.includes(value) && !disabled && !isPopUp;\n\n  const handleClick = (e: React.MouseEvent<HTMLLIElement, MouseEvent>) => {\n    e.stopPropagation();\n    onExpand(value, expanded);\n  };\n\n  const handleMouseEvent = (type: 'leave' | 'enter') => {\n    if (!isPopUp) return;\n    if (type === 'enter') setOpen(true);\n    else if (type === 'leave') setOpen(false);\n  };\n\n  const childrens = React.Children.map(children, (child) =>\n    React.cloneElement(child as ReactElement, {\n      className: classNames(\n        `${classPrefix}-menu__item--plain`,\n        `${classPrefix}-submenu__item`,\n        `${classPrefix}-submenu__item--icon`,\n      ),\n    }),\n  );\n\n  // 计算有多少子节点并设置最大高度，为做出动画效果\n  const childStyle = {\n    maxHeight: isExpand || (open && isPopUp) ? getSubMenuMaxHeight(children) : 0,\n  };\n\n  // 是否展开（popup 与 expand 两种状态）\n  const isOpen = useMemo(() => {\n    if (disabled) return false;\n    if (isPopUp) return open;\n    return isExpand;\n  }, [disabled, isPopUp, open, isExpand]);\n\n  // 计算左边距，兼容多层级子菜单\n  const menuPaddingLeft = cacularPaddingLeft(level - 1);\n\n  const fakeArrowStyle = isPopUp && level > 1 ? { transform: 'rotate(-90deg)' } : {};\n\n  return (\n    <li\n      className={classNames(className, `${classPrefix}-submenu`, {\n        [`${classPrefix}-is-disabled`]: disabled,\n        [`${classPrefix}-is-opened`]: isOpen,\n      })}\n      onClick={handleClick}\n      style={style}\n      onMouseEnter={() => handleMouseEvent('enter')}\n      onMouseLeave={() => handleMouseEvent('leave')}\n    >\n      <div\n        className={classNames(`${classPrefix}-menu__item`, {\n          [`${classPrefix}-is-opened`]: isOpen,\n          [`${classPrefix}-is-active`]: checkSubMenuChildrenActive(children, active),\n        })}\n      >\n        {icon} <span className={`${classPrefix}-menu__content`}>{title}</span>\n        <FakeArrow style={fakeArrowStyle} isActive={isOpen} disabled={disabled} />\n      </div>\n      {isPopUp ? (\n        <div\n          className={classNames(`${classPrefix}-menu__popup`, `${classPrefix}-is-vertical`, {\n            [`${classPrefix}-is-opened`]: isOpen,\n          })}\n        >\n          <ul\n            className={classNames(`${classPrefix}-menu__popup-wrapper`, {\n              [`${classPrefix}-is-opened`]: isOpen,\n            })}\n            key=\"popup\"\n            style={childStyle}\n          >\n            {childrens}\n          </ul>\n        </div>\n      ) : (\n        <ul\n          key=\"normal\"\n          style={{ ...childStyle, '--padding-left': `${menuPaddingLeft}px` } as React.CSSProperties}\n          className={`${classPrefix}-menu__sub`}\n        >\n          {childrens}\n        </ul>\n      )}\n    </li>\n  );\n};\n\nconst SubTitleMenu: FC<SubMenuWithCustomizeProps> = (props) => {\n  const { className, style, children, title, value, level } = props;\n  const { active, onChange, expandType } = useContext(MenuContext);\n  const { classPrefix } = useConfig();\n  const [open, setOpen] = useState(false);\n\n  const handleClick = () => onChange(value);\n\n  // 斜八角动画\n  const subMenuRef = useRef();\n  useRipple(subMenuRef);\n\n  // pupup 导航\n  const isPopUp = expandType === 'popup';\n  // 当前二级导航激活\n  const isActive = checkSubMenuChildrenActive(children, active) || active === value;\n\n  const handleMouseEvent = (type: 'leave' | 'enter') => {\n    if (!isPopUp) return;\n    if (type === 'enter') setOpen(true);\n    else if (type === 'leave') setOpen(false);\n  };\n\n  const fakeArrowStyle = level > 1 ? { transform: 'rotate(-90deg)' } : {};\n\n  return (\n    <li\n      className={classNames(`${classPrefix}-submenu`, {\n        [`${classPrefix}-is-opened`]: open,\n      })}\n      onMouseEnter={() => handleMouseEvent('enter')}\n      onMouseLeave={() => handleMouseEvent('leave')}\n    >\n      <div\n        ref={subMenuRef}\n        className={classNames(className, `${classPrefix}-menu__item`, {\n          [`${classPrefix}-is-active`]: isActive,\n          [`${classPrefix}-is-opened`]: open,\n        })}\n        onClick={handleClick}\n        style={style}\n      >\n        <span>{title}</span>\n        {isPopUp && <FakeArrow style={fakeArrowStyle} isActive={open} />}\n      </div>\n      {isPopUp && (\n        <div\n          className={classNames(`${classPrefix}-menu__popup`, {\n            [`${classPrefix}-is-opened`]: open,\n          })}\n          style={{ '--popup-max-height': getSubMenuMaxHeight(children) } as React.CSSProperties}\n        >\n          <ul className={classNames(`${classPrefix}-menu__popup-wrapper`)}>{children}</ul>\n        </div>\n      )}\n    </li>\n  );\n};\n\nconst SubMenu: FC<SubMenuWithCustomizeProps> = (props) => {\n  const { mode } = useContext(MenuContext);\n  const { children, level = 1 } = props;\n\n  // 如果是第二层及以及的 subMenu 需要添加 notFirstLevelSubMenu 属性\n  const childElement = React.Children.map(children, (item: React.ReactElement) =>\n    checkIsSubMenu(item)\n      ? React.cloneElement(item, {\n          level: level + 1,\n        })\n      : item,\n  );\n\n  if (mode === 'accordion') return <SubAccordion {...props}>{childElement}</SubAccordion>;\n  if (mode === 'title') return <SubTitleMenu {...props}>{childElement}</SubTitleMenu>;\n  return null;\n};\n\nSubMenu.displayName = 'SubMenu';\n\nexport default SubMenu;\n"],"names":["SubAccordion","props","content","children","disabled","icon","title","value","className","style","level","useConfig","classPrefix","useState","open","setOpen","useContext","MenuContext","expanded","onExpand","active","expandType","isPopUp","isExpand","includes","handleClick","e","stopPropagation","handleMouseEvent","type","childrens","React","Children","map","child","cloneElement","classNames","childStyle","maxHeight","getSubMenuMaxHeight","isOpen","useMemo","menuPaddingLeft","cacularPaddingLeft","fakeArrowStyle","transform","createElement","onClick","onMouseEnter","onMouseLeave","checkSubMenuChildrenActive","FakeArrow","isActive","key","SubTitleMenu","onChange","subMenuRef","useRef","useRipple","ref","SubMenu","mode","childElement","item","checkIsSubMenu","displayName"],"mappings":"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"}