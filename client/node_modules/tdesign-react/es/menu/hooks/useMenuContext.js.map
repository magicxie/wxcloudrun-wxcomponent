{"version":3,"file":"useMenuContext.js","sources":["../../../src/menu/hooks/useMenuContext.ts"],"sourcesContent":["import { noop } from 'lodash';\nimport { useState, ReactNode } from 'react';\nimport { MenuState, SetMenuState, MenuMode } from '../MenuContext';\nimport checkSubMenuChildExpanded from '../_util/checkSubMenuChildExpanded';\nimport { TdMenuProps, TdHeadMenuProps, MenuValue } from '../type';\n\ninterface UseMenuContextProps extends Extract<TdMenuProps, TdHeadMenuProps> {\n  children: ReactNode;\n  mode: MenuMode;\n}\n\nfunction useMenuContext({\n  defaultValue,\n  defaultExpanded,\n  expandMutex,\n  children,\n  onExpand = noop,\n  onChange = noop,\n  value,\n  expanded,\n  collapsed,\n  expandType,\n  theme,\n  mode,\n}: UseMenuContextProps) {\n  const [state, setState] = useState<MenuState>({\n    active: defaultValue,\n    expanded: defaultExpanded,\n  });\n\n  const setStateValue: SetMenuState = (menuState) => setState({ ...state, ...menuState });\n\n  const handleExpandChange = (value: MenuValue, expanded: MenuValue[]) => {\n    let nextExpand = [];\n    const index = expanded.indexOf(value);\n\n    // 已经展开\n    if (index > -1) {\n      // 互斥情况\n      if (expandMutex) {\n        nextExpand = expanded.slice(0, index);\n      } else {\n        nextExpand = expanded.filter((item) => item !== value);\n      }\n    } else if (expandMutex) {\n      // 未展开\n      nextExpand = checkSubMenuChildExpanded(children, expanded, value);\n    } else {\n      nextExpand = [...expanded, value];\n    }\n    onExpand(nextExpand);\n    setState({ expanded: nextExpand });\n  };\n\n  return {\n    value: {\n      onExpand: handleExpandChange,\n      onChange,\n      active: value || state.active,\n      expanded: expanded || state.expanded,\n      collapsed: collapsed || state.collapsed,\n      setState: setStateValue,\n      expandMutex,\n      expandType: collapsed ? 'popup' : expandType,\n      mode,\n      theme,\n    },\n  };\n}\n\nexport default useMenuContext;\n"],"names":["useMenuContext","defaultValue","defaultExpanded","expandMutex","children","onExpand","noop","onChange","value","expanded","collapsed","expandType","theme","mode","useState","active","state","setState","setStateValue","menuState","handleExpandChange","value2","expanded2","nextExpand","index","indexOf","slice","filter","item","checkSubMenuChildExpanded"],"mappings":";;;;;;;;;;;;;;;;;;;AAGA,SAASA,cAAT,OAaG;AAAA,MAZDC,YAYC,QAZDA,YAYC;AAAA,MAXDC,eAWC,QAXDA,eAWC;AAAA,MAVDC,WAUC,QAVDA,WAUC;AAAA,MATDC,QASC,QATDA,QASC;AAAA,2BARDC,QAQC;AAAA,MARDA,QAQC,8BARUC,IAQV;AAAA,2BAPDC,QAOC;AAAA,MAPDA,QAOC,8BAPUD,IAOV;AAAA,MANDE,KAMC,QANDA,KAMC;AAAA,MALDC,QAKC,QALDA,QAKC;AAAA,MAJDC,SAIC,QAJDA,SAIC;AAAA,MAHDC,UAGC,QAHDA,UAGC;AAAA,MAFDC,KAEC,QAFDA,KAEC;AAAA,MADDC,IACC,QADDA,IACC;;AACD,kBAA0BC,QAAQ,CAAC;AACjCC,IAAAA,MAAM,EAAEd,YADyB;AAEjCQ,IAAAA,QAAQ,EAAEP;AAFuB,GAAD,CAAlC;AAAA;AAAA,MAAOc,KAAP;AAAA,MAAcC,QAAd;;AAIA,MAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACC,SAAD;AAAA,WAAeF,QAAQ,iCAAMD,KAAN,GAAgBG,SAAhB,EAAvB;AAAA,GAAtB;;AACA,MAAMC,kBAAkB,GAAG,SAArBA,kBAAqB,CAACC,MAAD,EAASC,SAAT,EAAuB;AAChD,QAAIC,UAAU,GAAG,EAAjB;AACA,QAAMC,KAAK,GAAGF,SAAS,CAACG,OAAV,CAAkBJ,MAAlB,CAAd;;AACA,QAAIG,KAAK,GAAG,CAAC,CAAb,EAAgB;AACd,UAAIrB,WAAJ,EAAiB;AACfoB,QAAAA,UAAU,GAAGD,SAAS,CAACI,KAAV,CAAgB,CAAhB,EAAmBF,KAAnB,CAAb;AACD,OAFD,MAEO;AACLD,QAAAA,UAAU,GAAGD,SAAS,CAACK,MAAV,CAAiB,UAACC,IAAD;AAAA,iBAAUA,IAAI,KAAKP,MAAnB;AAAA,SAAjB,CAAb;AACD;AACF,KAND,MAMO,IAAIlB,WAAJ,EAAiB;AACtBoB,MAAAA,UAAU,GAAGM,yBAAyB,CAACzB,QAAD,EAAWkB,SAAX,EAAsBD,MAAtB,CAAtC;AACD,KAFM,MAEA;AACLE,MAAAA,UAAU,gCAAOD,SAAP,IAAkBD,MAAlB,EAAV;AACD;;AACDhB,IAAAA,QAAQ,CAACkB,UAAD,CAAR;AACAN,IAAAA,QAAQ,CAAC;AAAER,MAAAA,QAAQ,EAAEc;AAAZ,KAAD,CAAR;AACD,GAhBD;;AAiBA,SAAO;AACLf,IAAAA,KAAK,EAAE;AACLH,MAAAA,QAAQ,EAAEe,kBADL;AAELb,MAAAA,QAAQ,EAARA,QAFK;AAGLQ,MAAAA,MAAM,EAAEP,KAAK,IAAIQ,KAAK,CAACD,MAHlB;AAILN,MAAAA,QAAQ,EAAEA,QAAQ,IAAIO,KAAK,CAACP,QAJvB;AAKLC,MAAAA,SAAS,EAAEA,SAAS,IAAIM,KAAK,CAACN,SALzB;AAMLO,MAAAA,QAAQ,EAAEC,aANL;AAOLf,MAAAA,WAAW,EAAXA,WAPK;AAQLQ,MAAAA,UAAU,EAAED,SAAS,GAAG,OAAH,GAAaC,UAR7B;AASLE,MAAAA,IAAI,EAAJA,IATK;AAULD,MAAAA,KAAK,EAALA;AAVK;AADF,GAAP;AAcD;;;;"}