{"version":3,"file":"dragger.js","sources":["../../src/upload/dragger.tsx"],"sourcesContent":["import React, { DragEvent, FC, useState } from 'react';\nimport classNames from 'classnames';\nimport { TNode } from '../common';\nimport { TriggerContext, UploadFile, UploadRemoveContext } from './type';\nimport { CustomDraggerRenderProps } from './types';\nimport useConfig from '../_util/useConfig';\nimport DraggerProgress from './themes/dragger-progress';\n\nexport interface DraggerProps {\n  file?: UploadFile;\n  display?: string;\n  trigger?: string | TNode<TriggerContext>;\n  customDraggerRender?: (props: CustomDraggerRenderProps) => TNode;\n  onCancel?: () => void;\n  onTrigger?: () => void;\n  onRemove?: (context: UploadRemoveContext) => void;\n  onUpload?: (uploadFile: UploadFile) => void;\n  onChange?: (files: FileList) => void;\n  onDragenter?: (e: DragEvent) => void;\n  onDragleave?: (e: DragEvent) => void;\n}\n\nconst Dragger: FC<DraggerProps> = (props) => {\n  const { file, display, onUpload, onRemove, customDraggerRender } = props;\n  const { classPrefix } = useConfig();\n  const [dragActive, setDragActive] = useState(false);\n  const target = React.useRef();\n\n  const classes = classNames(\n    `${classPrefix}-upload__dragger`,\n    !file ? `${classPrefix}-upload__dragger-center` : '',\n    file?.status === 'fail' ? `${classPrefix}-upload__dragger-error` : '',\n  );\n\n  const defaultDragElement = React.useMemo(() => {\n    const unActiveElement = (\n      <div>\n        <span className={`${classPrefix}-upload--highlight`}>点击上传</span>\n        <span>&nbsp;&nbsp;/&nbsp;&nbsp;拖拽到此区域</span>\n      </div>\n    );\n    const activeElement = <div>释放鼠标</div>;\n    return dragActive ? activeElement : unActiveElement;\n  }, [classPrefix, dragActive]);\n\n  const dragElement = React.useMemo(() => {\n    let content: React.ReactNode;\n    if (file && display !== 'custom') {\n      content = (\n        <DraggerProgress\n          onRemove={onRemove}\n          display={display}\n          onTrigger={props.onTrigger}\n          file={file}\n          onUpload={() => {\n            onUpload?.(file);\n          }}\n        />\n      );\n    } else {\n      content = (\n        <div className={`${classPrefix}-upload__trigger`} onClick={props.onTrigger}>\n          {customDraggerRender?.({ dragActive }) || defaultDragElement}\n        </div>\n      );\n    }\n\n    return content;\n  }, [classPrefix, defaultDragElement, display, dragActive, file, onRemove, onUpload, props, customDraggerRender]);\n\n  const handleDrop = (event: DragEvent) => {\n    event.preventDefault();\n    props.onChange?.(event.dataTransfer.files);\n    props.onDragleave?.(event);\n    setDragActive(false);\n  };\n\n  const handleDragenter = (event: DragEvent) => {\n    event.preventDefault();\n    props.onDragenter?.(event);\n    setDragActive(true);\n  };\n\n  const handleDragleave = (event: DragEvent) => {\n    if (!target.current) return;\n    event.preventDefault();\n    props.onDragleave?.(event);\n    setDragActive(false);\n  };\n\n  const handleDragover = (event: DragEvent) => {\n    event.preventDefault();\n  };\n\n  return (\n    <div\n      ref={target}\n      className={classes}\n      onDrop={handleDrop}\n      onDragEnter={handleDragenter}\n      onDragOver={handleDragover}\n      onDragLeave={handleDragleave}\n    >\n      {dragElement}\n    </div>\n  );\n};\n\nexport default Dragger;\n"],"names":["Dragger","props","file","display","onUpload","onRemove","customDraggerRender","useConfig","classPrefix","useState","dragActive","setDragActive","target","React","useRef","classes","classNames","status","defaultDragElement","useMemo","unActiveElement","createElement","className","activeElement","dragElement","content","DraggerProgress","onTrigger","onClick","handleDrop","event","preventDefault","onChange","dataTransfer","files","onDragleave","handleDragenter","onDragenter","handleDragleave","current","handleDragover","ref","onDrop","onDragEnter","onDragOver","onDragLeave"],"mappings":"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"}