{"version":3,"file":"dom.js","sources":["../../src/_util/dom.ts"],"sourcesContent":["import raf from 'raf';\nimport isString from 'lodash/isString';\nimport { easeInOutCubic, EasingFunction } from './easing';\nimport { ScrollContainer, ScrollContainerElement } from '../common';\n\nconst isServer = typeof window === 'undefined';\n\nconst trim = (str: string): string => (str || '').replace(/^[\\s\\uFEFF]+|[\\s\\uFEFF]+$/g, '');\n\nexport const on = ((): any => {\n  if (!isServer && document.addEventListener) {\n    return (element: Node, event: string, handler: EventListenerOrEventListenerObject): any => {\n      if (element && event && handler) {\n        element.addEventListener(event, handler, false);\n      }\n    };\n  }\n  return (element: Node, event: string, handler: EventListenerOrEventListenerObject): any => {\n    if (element && event && handler) {\n      (element as any).attachEvent(`on${event}`, handler);\n    }\n  };\n})();\n\nexport const off = ((): any => {\n  if (!isServer && document.removeEventListener) {\n    return (element: Node, event: string, handler: EventListenerOrEventListenerObject): any => {\n      if (element && event) {\n        element.removeEventListener(event, handler, false);\n      }\n    };\n  }\n  return (element: Node, event: string, handler: EventListenerOrEventListenerObject): any => {\n    if (element && event) {\n      (element as any).detachEvent(`on${event}`, handler);\n    }\n  };\n})();\n\nfunction hasClass(el: Element, cls: string) {\n  if (!el || !cls) return false;\n  if (cls.indexOf(' ') !== -1) throw new Error('className should not contain space.');\n  if (el.classList) {\n    return el.classList.contains(cls);\n  }\n  return ` ${el.className} `.indexOf(` ${cls} `) > -1;\n}\n\nexport const addClass = function (el: Element, cls: string) {\n  if (!el) return;\n  let curClass = el.className;\n  const classes = (cls || '').split(' ');\n\n  for (let i = 0, j = classes.length; i < j; i++) {\n    const clsName = classes[i];\n    if (!clsName) continue;\n\n    if (el.classList) {\n      el.classList.add(clsName);\n    } else if (!hasClass(el, clsName)) {\n      curClass += ` ${clsName}`;\n    }\n  }\n  if (!el.classList) {\n    // eslint-disable-next-line\n    el.className = curClass;\n  }\n};\n\nexport const removeClass = function (el: Element, cls: string) {\n  if (!el || !cls) return;\n  const classes = cls.split(' ');\n  let curClass = ` ${el.className} `;\n\n  for (let i = 0, j = classes.length; i < j; i++) {\n    const clsName = classes[i];\n    if (!clsName) continue;\n\n    if (el.classList) {\n      el.classList.remove(clsName);\n    } else if (hasClass(el, clsName)) {\n      curClass = curClass.replace(` ${clsName} `, ' ');\n    }\n  }\n  if (!el.classList) {\n    // eslint-disable-next-line\n    el.className = trim(curClass);\n  }\n};\n\n/**\n * 获取滚动容器\n * 因为document不存在scroll等属性, 因此排除document\n * window | HTMLElement\n * @param {ScrollContainerElement} [container='body']\n * @returns {ScrollContainer}\n */\nexport const getScrollContainer = (container: ScrollContainer = 'body'): ScrollContainerElement => {\n  if (isString(container)) {\n    return container ? (document.querySelector(container) as HTMLElement) : window;\n  }\n  if (typeof container === 'function') {\n    return container();\n  }\n  return container;\n};\n\n/**\n * 返回是否window对象\n *\n * @export\n * @param {any} obj\n * @returns\n */\nfunction isWindow(obj: any) {\n  return obj && obj === obj.window;\n}\n\ntype ScrollTarget = HTMLElement | Window | Document;\n\n/**\n * 获取滚动距离\n *\n * @export\n * @param {ScrollTarget} target\n * @param {boolean} isLeft true为获取scrollLeft, false为获取scrollTop\n * @returns {number}\n */\nexport function getScroll(target: ScrollTarget, isLeft?: boolean): number {\n  // node环境或者target为空\n  if (typeof window === 'undefined' || !target) {\n    return 0;\n  }\n  const method = isLeft ? 'scrollLeft' : 'scrollTop';\n  let result = 0;\n  if (isWindow(target)) {\n    result = (target as Window)[isLeft ? 'pageXOffset' : 'pageYOffset'];\n  } else if (target instanceof Document) {\n    result = target.documentElement[method];\n  } else if (target) {\n    result = (target as HTMLElement)[method];\n  }\n  return result;\n}\ninterface ScrollTopOptions {\n  container?: ScrollTarget;\n  duration?: number;\n  easing?: EasingFunction;\n}\n\nexport function scrollTo(target: number, opt: ScrollTopOptions) {\n  const { container = window, duration = 450, easing = easeInOutCubic } = opt;\n  const scrollTop = getScroll(container);\n  const startTime = Date.now();\n  return new Promise((res) => {\n    const fnc = () => {\n      const timestamp = Date.now();\n      const time = timestamp - startTime;\n      const nextScrollTop = easing(Math.min(time, duration), scrollTop, target, duration);\n      if (isWindow(container)) {\n        (container as Window).scrollTo(window.pageXOffset, nextScrollTop);\n      } else if (container instanceof HTMLDocument || container.constructor.name === 'HTMLDocument') {\n        (container as HTMLDocument).documentElement.scrollTop = nextScrollTop;\n      } else {\n        (container as HTMLElement).scrollTop = nextScrollTop;\n      }\n      if (time < duration) {\n        raf(fnc);\n      } else {\n        // 由于上面步骤设置了scrollTop, 滚动事件可能未触发完毕\n        // 此时应该在下一帧再执行res\n        raf(res);\n      }\n    };\n    raf(fnc);\n  });\n}\n\n// 用于判断节点内容是否溢出\nexport const isNodeOverflow = (ele: Element | Element[]): boolean => {\n  const { clientWidth = 0, scrollWidth = 0 } = ele as Element & { clientWidth: number; scrollWidth: number };\n\n  if (scrollWidth > clientWidth) {\n    return true;\n  }\n  return false;\n};\n\nexport const getAttach = (node: any): HTMLElement => {\n  const attachNode = typeof node === 'function' ? node() : node;\n  if (!attachNode) {\n    return document.body;\n  }\n  if (isString(attachNode)) {\n    return document.querySelector(attachNode);\n  }\n  if (attachNode instanceof HTMLElement) {\n    return attachNode;\n  }\n  return document.body;\n};\n"],"names":["isServer","window","trim","str","replace","on","document","addEventListener","element","event","handler","attachEvent","off","removeEventListener","detachEvent","hasClass","el","cls","indexOf","Error","classList","contains","className","addClass","curClass","classes","split","i","j","length","clsName","add","removeClass","remove","getScrollContainer","container","isString","querySelector","isWindow","obj","getScroll","target","isLeft","method","result","Document","documentElement","scrollTo","opt","duration","easing","easeInOutCubic","scrollTop","startTime","Date","now","Promise","res","fnc","timestamp","time","nextScrollTop","Math","min","pageXOffset","HTMLDocument","constructor","name","raf","isNodeOverflow","ele","clientWidth","scrollWidth","getAttach","node","attachNode","body","HTMLElement"],"mappings":"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"}