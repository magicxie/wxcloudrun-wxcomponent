{"version":3,"file":"Dialog.js","sources":["../../src/dialog/Dialog.tsx"],"sourcesContent":["import React, { forwardRef, useEffect, useMemo } from 'react';\nimport isString from 'lodash/isString';\nimport { CloseIcon, InfoCircleFilledIcon, CheckCircleFilledIcon } from 'tdesign-icons-react';\nimport { useLocaleReceiver } from '../locale/LocalReceiver';\nimport { ConfigContext } from '../config-provider';\nimport Button from '../button';\nimport { TdDialogProps, DialogInstance } from './type';\nimport { StyledProps } from '../common';\nimport noop from '../_util/noop';\nimport RenderDialog from './RenderDialog';\nimport useSetState from '../_util/useSetState';\n\nexport interface DialogProps extends TdDialogProps, StyledProps {\n  /**\n   * 是否以插件形式调用\n   */\n  isPlugin?: boolean;\n}\n\nconst Dialog: React.ForwardRefRenderFunction<DialogInstance, DialogProps> = (props, ref) => {\n  const { classPrefix } = React.useContext(ConfigContext);\n  const [state, setState] = useSetState<DialogProps>({\n    width: 520,\n    visible: false,\n    zIndex: 2500,\n    placement: 'center',\n    mode: 'modal',\n    showOverlay: true,\n    destroyOnClose: false,\n    draggable: false,\n    preventScrollThrough: true,\n    isPlugin: false,\n    ...props,\n  });\n\n  const [local, t] = useLocaleReceiver('dialog');\n  const confirmText = t(local.confirm);\n  const cancelText = t(local.cancel);\n\n  const {\n    visible,\n    attach: getContainer = 'body',\n    closeBtn,\n    footer,\n    onCancel = noop,\n    onConfirm = noop,\n    cancelBtn = cancelText,\n    confirmBtn = confirmText,\n    onClose = noop,\n    isPlugin = false,\n    ...restState\n  } = state;\n\n  useEffect(() => {\n    // 插件式调用不会更新props, 只有组件式调用才会更新props\n    if (!isPlugin) {\n      setState((prevState) => ({\n        ...prevState,\n        ...props,\n      }));\n    }\n  }, [props, setState, isPlugin]);\n\n  const prefixCls = `${classPrefix}-dialog`;\n  const renderCloseIcon = () => {\n    if (closeBtn === false) return null;\n    if (closeBtn === true) return <CloseIcon style={{ verticalAlign: 'unset' }} />;\n    return closeBtn || <CloseIcon style={{ verticalAlign: 'unset' }} />;\n  };\n\n  React.useImperativeHandle(ref, () => ({\n    show() {\n      setState({ visible: true });\n    },\n    hide() {\n      setState({ visible: false });\n    },\n    destroy: noop,\n    update(newOptions) {\n      setState((prevState) => ({\n        ...prevState,\n        ...(newOptions as DialogProps),\n      }));\n    },\n  }));\n\n  const renderHeader = useMemo(() => {\n    if (!state.header) return null;\n\n    const iconMap = {\n      info: <InfoCircleFilledIcon className={`${classPrefix}-is-info`} />,\n      warning: <InfoCircleFilledIcon className={`${classPrefix}-is-warning`} />,\n      error: <InfoCircleFilledIcon className={`${classPrefix}-is-error`} />,\n      success: <CheckCircleFilledIcon className={`${classPrefix}-is-success`} />,\n    };\n    return (\n      <div className={`${prefixCls}__header`}>\n        {iconMap[state.theme]}\n        {state.header}\n      </div>\n    );\n  }, [state.header, state.theme, prefixCls, classPrefix]);\n\n  const handleCancel = (e: React.MouseEvent<HTMLButtonElement>) => {\n    onCancel({ e });\n    onClose({ e, trigger: 'cancel' });\n  };\n\n  const handleConfirm = (e: React.MouseEvent<HTMLButtonElement>) => {\n    onConfirm({ e });\n  };\n\n  const defaultFooter = () => {\n    let renderCancelBtn = cancelBtn && (\n      <Button variant=\"outline\">{isString(cancelBtn) ? cancelBtn : cancelText}</Button>\n    );\n\n    let renderConfirmBtn = confirmBtn && (\n      <Button theme=\"primary\">{isString(confirmBtn) ? confirmBtn : confirmText}</Button>\n    );\n\n    if (React.isValidElement(cancelBtn)) {\n      renderCancelBtn = cancelBtn;\n    }\n\n    if (React.isValidElement(confirmBtn)) {\n      renderConfirmBtn = confirmBtn;\n    }\n\n    if (typeof cancelBtn === 'function') {\n      renderCancelBtn = cancelBtn();\n    }\n\n    if (typeof confirmBtn === 'function') {\n      renderConfirmBtn = confirmBtn();\n    }\n    return (\n      <>\n        {renderCancelBtn &&\n          React.cloneElement(renderCancelBtn, {\n            onClick: handleCancel,\n            ...renderCancelBtn.props,\n          })}\n        {renderConfirmBtn &&\n          React.cloneElement(renderConfirmBtn, {\n            onClick: handleConfirm,\n            ...renderConfirmBtn.props,\n          })}\n      </>\n    );\n  };\n\n  return (\n    <RenderDialog\n      {...restState}\n      visible={visible}\n      prefixCls={prefixCls}\n      header={renderHeader}\n      getContainer={getContainer}\n      closeBtn={renderCloseIcon()}\n      classPrefix={classPrefix}\n      onClose={onClose}\n      footer={footer === undefined ? defaultFooter() : footer}\n    />\n  );\n};\n\nexport default forwardRef(Dialog);\n"],"names":["Dialog","props","ref","React","useContext","ConfigContext","classPrefix","useSetState","width","visible","zIndex","placement","mode","showOverlay","destroyOnClose","draggable","preventScrollThrough","isPlugin","state","setState","useLocaleReceiver","local","t","confirmText","confirm","cancelText","cancel","attach","getContainer","closeBtn","footer","onCancel","noop","onConfirm","cancelBtn","confirmBtn","onClose","restState","useEffect","prevState","prefixCls","renderCloseIcon","createElement","CloseIcon","style","verticalAlign","useImperativeHandle","show","hide","destroy","update","newOptions","renderHeader","useMemo","header","iconMap","info","InfoCircleFilledIcon","className","warning","error","success","CheckCircleFilledIcon","theme","handleCancel","e","trigger","handleConfirm","defaultFooter","renderCancelBtn","Button","variant","isString","renderConfirmBtn","isValidElement","Fragment","cloneElement","onClick","RenderDialog","forwardRef"],"mappings":"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"}