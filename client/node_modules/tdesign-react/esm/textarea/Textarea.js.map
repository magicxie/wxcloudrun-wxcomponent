{"version":3,"file":"Textarea.js","sources":["../../src/textarea/Textarea.tsx"],"sourcesContent":["import React, { forwardRef, useState, useMemo } from 'react';\nimport classNames from 'classnames';\nimport useConfig from '../_util/useConfig';\nimport { TdTextareaProps } from './type';\nimport { StyledProps } from '../common';\nimport noop from '../_util/noop';\nimport useDefault from '../_util/useDefault';\nimport { getCharacterLength } from '../_util/helper';\n\nexport interface TextareaProps extends TdTextareaProps, StyledProps {}\n\nconst Textarea = forwardRef((props: TextareaProps, ref: React.Ref<HTMLInputElement>) => {\n  const {\n    disabled,\n    maxlength,\n    maxcharacter,\n    className,\n    readonly,\n    autofocus,\n    defaultValue,\n    style,\n    onKeydown = noop,\n    onKeypress = noop,\n    onKeyup = noop,\n    autosize = false,\n    ...otherProps\n  } = props;\n\n  const [value = '', setValue] = useDefault(props.value, defaultValue, props.onChange);\n  const [isFocused, setIsFocused] = useState(false);\n\n  const hasMaxcharacter = typeof maxcharacter !== 'undefined';\n\n  const currentLength = useMemo(() => (value ? String(value).length : 0), [value]);\n  const characterLength = useMemo(() => {\n    const characterInfo = getCharacterLength(String(value), maxcharacter);\n    if (typeof characterInfo === 'object') return characterInfo.length;\n    return characterInfo;\n  }, [value, maxcharacter]);\n\n  const { classPrefix } = useConfig();\n\n  const textareaPropsNames = Object.keys(otherProps).filter((key) => !/^on[A-Z]/.test(key));\n  const textareaProps = textareaPropsNames.reduce(\n    (textareaProps, key) => Object.assign(textareaProps, { [key]: props[key] }),\n    {},\n  );\n  const eventPropsNames = Object.keys(otherProps).filter((key) => /^on[A-Z]/.test(key));\n  const eventProps = eventPropsNames.reduce((eventProps, key) => {\n    Object.assign(eventProps, {\n      [key]: (e) => {\n        if (disabled) return;\n        if (key === 'onFocus') setIsFocused(true);\n        if (key === 'onBlur') setIsFocused(false);\n        props[key](e.currentTarget.value, { e });\n      },\n    });\n    return eventProps;\n  }, {});\n\n  const textareaClassNames = classNames(className, `${classPrefix}-textarea__inner`, {\n    [`${classPrefix}-is-disabled`]: disabled,\n    [`${classPrefix}-is-focused`]: isFocused,\n    [`${classPrefix}-resize-none`]: typeof autosize === 'object',\n  });\n\n  function inputValueChangeHandle(e: React.FormEvent<HTMLTextAreaElement>) {\n    const { target } = e;\n    let val = (target as HTMLInputElement).value;\n    if (maxcharacter && maxcharacter >= 0) {\n      const stringInfo = getCharacterLength(val, maxcharacter);\n      val = typeof stringInfo === 'object' && stringInfo.characters;\n    }\n    setValue(val, { e });\n  }\n\n  // 当未设置 autosize 时，需要将 textarea 的 height 设置为 auto，以支持原生的 textarea rows 属性\n  return (\n    <div ref={ref} style={style} className={classNames(className, `${classPrefix}-textarea`)}>\n      <textarea\n        {...textareaProps}\n        {...eventProps}\n        value={value}\n        style={{\n          height: autosize ? null : 'auto',\n        }}\n        className={textareaClassNames}\n        readOnly={readonly}\n        autoFocus={autofocus}\n        disabled={disabled}\n        maxLength={maxlength}\n        onChange={inputValueChangeHandle}\n        onKeyDown={(e) => onKeydown(e.currentTarget.value, { e })}\n        onKeyPress={(e) => onKeypress(e.currentTarget.value, { e })}\n        onKeyUp={(e) => onKeyup(e.currentTarget.value, { e })}\n      />\n      {hasMaxcharacter ? (\n        <span className={`${classPrefix}-textarea__limit`}>{`${characterLength}/${maxcharacter}`}</span>\n      ) : null}\n      {!hasMaxcharacter && maxlength ? (\n        <span className={`${classPrefix}-textarea__limit`}>{`${currentLength}/${maxlength}`}</span>\n      ) : null}\n    </div>\n  );\n});\n\nTextarea.displayName = 'Textarea';\n\nexport default Textarea;\n"],"names":["Textarea","forwardRef","props","ref","disabled","maxlength","maxcharacter","className","readonly","autofocus","defaultValue","style","onKeydown","noop","onKeypress","onKeyup","autosize","otherProps","useDefault","value","onChange","setValue","useState","isFocused","setIsFocused","hasMaxcharacter","currentLength","useMemo","String","length","characterLength","characterInfo","getCharacterLength","useConfig","classPrefix","textareaPropsNames","Object","keys","filter","key","test","textareaProps","reduce","textareaProps2","assign","eventPropsNames","eventProps","eventProps2","e","currentTarget","textareaClassNames","classNames","inputValueChangeHandle","target","val","stringInfo","characters","React","createElement","height","readOnly","autoFocus","maxLength","onKeyDown","onKeyPress","onKeyUp","displayName"],"mappings":"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"}