{"version":3,"file":"panel.js","sources":["../../../src/cascader/utils/panel.ts"],"sourcesContent":["import isNumber from 'lodash/isNumber';\nimport { TreeNode, CascaderContextType, CascaderProps, TreeNodeValue } from '../interface';\n\n/**\n * 面板数据计算方法\n * @param treeNodes\n * @returns\n */\nexport function getPanels(treeNodes: CascaderContextType['treeNodes']) {\n  const panels: TreeNode[][] = [];\n  treeNodes.forEach((node: TreeNode) => {\n    if (panels[node.level]) {\n      panels[node.level].push(node);\n    } else {\n      panels[node.level] = [node];\n    }\n  });\n  return panels;\n}\n\n/**\n * 点击item的副作用\n * @param propsTrigger\n * @param trigger\n * @param node\n * @param cascaderContext\n * @param onChange\n * @param ctx\n */\nexport function expendClickEffect(\n  propsTrigger: CascaderProps['trigger'],\n  trigger: CascaderProps['trigger'],\n  node: TreeNode,\n  cascaderContext: CascaderContextType,\n) {\n  const {\n    checkStrictly,\n    filterActive,\n    multiple,\n    treeStore,\n    setFilterActive,\n    setVisible,\n    setValue,\n    setTreeNodes,\n    setExpend,\n    value,\n    max,\n  } = cascaderContext;\n\n  const isDisabled = node.disabled || (multiple && (value as TreeNodeValue[]).length >= max && max !== 0);\n\n  if (isDisabled) return;\n  // 点击展开节点，设置展开状态\n  if (propsTrigger === trigger && !node.isLeaf()) {\n    const expanded = node.setExpanded(true);\n    treeStore.refreshNodes();\n    treeStore.replaceExpanded(expanded);\n    const nodes = treeStore.getNodes().filter((node: TreeNode) => node.visible);\n    setTreeNodes(nodes);\n\n    // 多选条件下\b手动维护expend\n    if (multiple) {\n      setExpend(expanded);\n    }\n  }\n\n  if (!multiple && (node.isLeaf() || checkStrictly) && trigger === 'click') {\n    treeStore.resetChecked();\n    const checked = node.setChecked(!node.isChecked());\n    const [value] = checked;\n\n    // 过滤状态下，点击后清除过滤状态\n    if (filterActive) {\n      setFilterActive(false);\n    }\n\n    // 非过滤状态下，关闭\n    if (!filterActive && !checkStrictly) {\n      setVisible(false);\n    }\n\n    // 非受控状态下更新状态\n    setValue(value, 'checked', node.getModel());\n  }\n}\n\n/**\n * 多选状态下选中状态数据变化的副作用\n * @param node\n * @param cascaderContext\n * @returns\n */\nexport function valueChangeEffect(node: TreeNode, cascaderContext: CascaderContextType) {\n  const { disabled, max, multiple, setVisible, setValue, filterActive, setFilterActive, treeNodes, treeStore } =\n    cascaderContext;\n\n  if (!node || disabled || node.disabled) {\n    return;\n  }\n  const checked = node.setChecked(!node.isChecked());\n\n  if (isNumber(max) && max < 0) {\n    console.warn('TDesign Warn:', 'max should > 0');\n  }\n\n  if (checked.length > max && isNumber(max) && max > 0) {\n    return;\n  }\n\n  if (checked.length === 0) {\n    const expanded = treeStore.getExpanded();\n    setTimeout(() => {\n      treeStore.replaceExpanded(expanded);\n      treeStore.refreshNodes();\n    }, 0);\n  }\n\n  if (!multiple) {\n    setVisible(false);\n  }\n\n  const isSelectAll = treeNodes.every((item) => checked.indexOf(item.value) > -1);\n\n  if (filterActive && isSelectAll) {\n    setVisible(false);\n    setFilterActive(false);\n  }\n\n  setValue(checked, 'checked', node.getModel());\n}\n"],"names":["getPanels","treeNodes","panels","forEach","node","level","push","expendClickEffect","propsTrigger","trigger","cascaderContext","checkStrictly","filterActive","multiple","treeStore","setFilterActive","setVisible","setValue","setTreeNodes","setExpend","value","max","isDisabled","disabled","length","isLeaf","expanded","setExpanded","refreshNodes","replaceExpanded","nodes","getNodes","filter","node2","visible","resetChecked","checked","setChecked","isChecked","value2","getModel","valueChangeEffect","isNumber","console","warn","getExpanded","setTimeout","isSelectAll","every","item","indexOf"],"mappings":"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"}