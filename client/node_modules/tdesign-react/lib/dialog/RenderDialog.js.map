{"version":3,"file":"RenderDialog.js","sources":["../../src/dialog/RenderDialog.tsx"],"sourcesContent":["import React, { useLayoutEffect, useRef, CSSProperties, useEffect } from 'react';\nimport { CSSTransition } from 'react-transition-group';\nimport classnames from 'classnames';\nimport Portal from '../common/Portal';\nimport { AttachNode } from '../common';\nimport noop from '../_util/noop';\nimport { DialogProps } from './Dialog';\n\nenum KeyCode {\n  ESC = 27,\n}\n\nexport interface RenderDialogProps extends DialogProps {\n  prefixCls?: string;\n  classPrefix: string;\n  getContainer?: React.ReactElement | AttachNode | boolean;\n}\n\nconst transitionTime = 300;\nlet mousePosition: { x: number; y: number } | null;\nconst getClickPosition = (e: MouseEvent) => {\n  mousePosition = {\n    x: e.clientX,\n    y: e.clientY,\n  };\n  setTimeout(() => {\n    mousePosition = null;\n  }, 100);\n};\nif (typeof window !== 'undefined' && window.document && window.document.documentElement) {\n  document.documentElement.addEventListener('click', getClickPosition, true);\n}\nconst RenderDialog: React.FC<RenderDialogProps> = (props) => {\n  const {\n    prefixCls,\n    getContainer,\n    visible,\n    mode,\n    zIndex,\n    showOverlay,\n    onEscKeydown = noop,\n    onClosed = noop,\n    onClose = noop,\n    onCloseBtnClick = noop,\n    onOverlayClick = noop,\n    preventScrollThrough,\n    closeBtn,\n  } = props;\n  const wrap = useRef<HTMLDivElement>();\n  const dialog = useRef<HTMLDivElement>();\n  const maskRef = useRef<HTMLDivElement>();\n  const bodyOverflow = useRef<string>(document.body.style.overflow);\n  const bodyCssTextRef = useRef<string>(document.body.style.cssText);\n  const isModal = mode === 'modal';\n  const canDraggable = props.draggable && mode === 'modeless';\n\n  useLayoutEffect(() => {\n    if (visible) {\n      if (isModal && bodyOverflow.current !== 'hidden' && preventScrollThrough) {\n        const scrollWidth = window.innerWidth - document.body.offsetWidth;\n        // 减少回流\n        if (bodyCssTextRef.current === '') {\n          let bodyCssText = 'overflow: hidden;';\n          if (scrollWidth > 0) {\n            bodyCssText += `position: relative;width: calc(100% - ${scrollWidth}px);`;\n          }\n          document.body.style.cssText = bodyCssText;\n        } else {\n          if (scrollWidth > 0) {\n            document.body.style.width = `calc(100% - ${scrollWidth}px)`;\n            document.body.style.position = 'relative';\n          }\n          document.body.style.overflow = 'hidden';\n        }\n      }\n      if (wrap.current) {\n        wrap.current.focus();\n      }\n    } else if (isModal) {\n      document.body.style.cssText = bodyCssTextRef.current;\n    }\n  }, [preventScrollThrough, getContainer, visible, mode, isModal]);\n\n  useEffect(() => {\n    if (visible) {\n      if (mousePosition && dialog.current) {\n        dialog.current.style.transformOrigin = `${mousePosition.x - dialog.current.offsetLeft}px ${\n          mousePosition.y - dialog.current.offsetTop\n        }px`;\n      }\n    }\n  }, [visible]);\n\n  const onAnimateLeave = () => {\n    if (wrap.current) {\n      wrap.current.style.display = 'none';\n    }\n    if (isModal && preventScrollThrough) {\n      // 还原body的滚动条\n      isModal && (document.body.style.overflow = bodyOverflow.current);\n    }\n    if (!isModal) {\n      const { style } = dialog.current;\n      style.left = '50%';\n      style.top = '50%';\n    }\n    onClosed && onClosed();\n  };\n\n  const onMaskClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    if (e.target === e.currentTarget) {\n      onOverlayClick({ e });\n      onClose({ e, trigger: 'overlay' });\n    }\n  };\n\n  const handleCloseBtnClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    onCloseBtnClick({ e });\n    onClose({ e, trigger: 'close-btn' });\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLDivElement>) => {\n    // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode\n    if (+e.code === KeyCode.ESC || e.keyCode === KeyCode.ESC) {\n      e.stopPropagation();\n      onEscKeydown({ e });\n      onClose({ e, trigger: 'esc' });\n    }\n  };\n\n  const renderDialog = (classNames) => {\n    const dest: any = {};\n    if (props.width !== undefined) {\n      dest.width = props.width;\n    }\n\n    const footer = props.footer ? <div className={`${prefixCls}__footer`}>{props.footer}</div> : null;\n\n    const header = <div className={`${prefixCls}__header`}>{props.header}</div>;\n\n    const body = <div className={`${prefixCls}__body`}>{props.body || props.children}</div>;\n\n    const closer = closeBtn && (\n      <span onClick={handleCloseBtnClick} className={`${prefixCls}__close`}>\n        {closeBtn}\n      </span>\n    );\n\n    const style = { ...dest, ...props.style };\n    let dialogOffset = { x: 0, y: 0 };\n    const onDialogMove = (e: MouseEvent) => {\n      const { style, offsetWidth, offsetHeight, clientHeight, clientWidth } = dialog.current;\n      const halfHeight = clientHeight / 2;\n      const halfWidth = clientWidth / 2;\n\n      let diffX = e.clientX - dialogOffset.x;\n      let diffY = e.clientY - dialogOffset.y;\n\n      if (diffX < halfWidth) {\n        diffX = halfWidth;\n      }\n      if (diffX > window.innerWidth - offsetWidth + halfWidth) {\n        diffX = window.innerWidth - offsetWidth + halfWidth;\n      }\n\n      if (diffY < halfHeight) {\n        diffY = halfHeight;\n      }\n\n      if (diffY > window.innerHeight - offsetHeight + halfHeight) {\n        diffY = window.innerHeight - offsetHeight + halfHeight;\n      }\n      style.left = `${diffX}px`;\n      style.top = `${diffY}px`;\n    };\n\n    const onDialogMoveEnd = () => {\n      dialog.current.style.cursor = 'default';\n      document.removeEventListener('mousemove', onDialogMove);\n      document.removeEventListener('mouseup', onDialogMoveEnd);\n    };\n\n    const onDialogMoveStart = (e: React.MouseEvent<HTMLDivElement>) => {\n      if (canDraggable) {\n        const { offsetLeft, offsetTop } = dialog.current;\n        dialog.current.style.cursor = 'move';\n        const diffX = e.clientX - offsetLeft;\n        const diffY = e.clientY - offsetTop;\n        dialogOffset = {\n          x: diffX,\n          y: diffY,\n        };\n\n        document.addEventListener('mousemove', onDialogMove);\n        document.addEventListener('mouseup', onDialogMoveEnd);\n      }\n    };\n\n    const dialogElement = (\n      <div\n        ref={dialog}\n        style={style}\n        className={classnames(`${prefixCls}`, `${prefixCls}--default`, classNames)}\n        onMouseDown={onDialogMoveStart}\n      >\n        {closer}\n        {header}\n        {body}\n        {footer}\n      </div>\n    );\n\n    return (\n      <CSSTransition\n        key=\"dialog\"\n        in={props.visible}\n        appear\n        mountOnEnter\n        unmountOnExit={props.destroyOnClose}\n        timeout={transitionTime}\n        classNames={`${prefixCls}-zoom`}\n        onEntered={props.onOpened}\n        onExited={onAnimateLeave}\n        nodeRef={dialog}\n      >\n        {dialogElement}\n      </CSSTransition>\n    );\n  };\n\n  const renderMask = () => {\n    let maskElement;\n    if (showOverlay) {\n      maskElement = (\n        <CSSTransition\n          in={visible}\n          appear\n          timeout={transitionTime}\n          classNames={`${prefixCls}-dialog-fade`}\n          mountOnEnter\n          unmountOnExit\n          key=\"mask\"\n          nodeRef={maskRef}\n        >\n          <div key=\"mask\" onClick={onMaskClick} className={`${prefixCls}__mask`} />\n        </CSSTransition>\n      );\n    }\n    return maskElement;\n  };\n\n  const render = () => {\n    const style: CSSProperties = {};\n    if (visible) {\n      style.display = 'block';\n    }\n    const wrapStyle = {\n      ...style,\n      zIndex,\n    };\n\n    const dialogBody = renderDialog(`${props.placement ? `${prefixCls}--${props.placement}` : ''}`);\n    const wrapClass = classnames(props.className, `${prefixCls}__ctx`, `${prefixCls}__ctx--fixed`);\n    const dialog = (\n      <div ref={wrap} className={wrapClass} style={wrapStyle} onKeyDown={handleKeyDown}>\n        {mode === 'modal' && renderMask()}\n        {dialogBody}\n      </div>\n    );\n\n    let dom = null;\n\n    if (visible || wrap.current) {\n      if (getContainer === false) {\n        dom = dialog;\n      } else {\n        dom = <Portal getContainer={getContainer}>{dialog}</Portal>;\n      }\n    }\n\n    return dom;\n  };\n\n  return render();\n};\n\nexport default RenderDialog;\n"],"names":["transitionTime","mousePosition","getClickPosition","e","x","clientX","y","clientY","setTimeout","window","document","documentElement","addEventListener","RenderDialog","props","prefixCls","getContainer","visible","mode","zIndex","showOverlay","onEscKeydown","noop","onClosed","onClose","onCloseBtnClick","onOverlayClick","preventScrollThrough","closeBtn","wrap","useRef","dialog","maskRef","bodyOverflow","body","style","overflow","bodyCssTextRef","cssText","isModal","canDraggable","draggable","useLayoutEffect","current","scrollWidth","innerWidth","offsetWidth","bodyCssText","width","position","focus","useEffect","transformOrigin","offsetLeft","offsetTop","onAnimateLeave","display","left","top","onMaskClick","target","currentTarget","trigger","handleCloseBtnClick","handleKeyDown","code","keyCode","stopPropagation","renderDialog","classNames","dest","footer","React","createElement","className","header","children","closer","onClick","dialogOffset","onDialogMove","style2","offsetHeight","clientHeight","clientWidth","halfHeight","halfWidth","diffX","diffY","innerHeight","onDialogMoveEnd","cursor","removeEventListener","onDialogMoveStart","dialogElement","ref","classnames","onMouseDown","CSSTransition","key","appear","mountOnEnter","unmountOnExit","destroyOnClose","timeout","onEntered","onOpened","onExited","nodeRef","renderMask","maskElement","render","wrapStyle","dialogBody","placement","wrapClass","dialog2","onKeyDown","dom","Portal"],"mappings":"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"}