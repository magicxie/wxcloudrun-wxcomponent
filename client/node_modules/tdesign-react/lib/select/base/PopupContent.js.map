{"version":3,"file":"PopupContent.js","sources":["../../../src/select/base/PopupContent.tsx"],"sourcesContent":["import React, { Children, isValidElement, cloneElement } from 'react';\nimport { useLocaleReceiver } from '../../locale/LocalReceiver';\nimport { getSelectValueArr } from '../util/helper';\nimport { TdSelectProps, SelectValue, TdOptionProps } from '../type';\nimport useConfig from '../../_util/useConfig';\nimport Option, { SelectOptionProps } from './Option';\n\ntype OptionsType = TdOptionProps[];\n\ninterface SelectPopupProps\n  extends Pick<\n    TdSelectProps,\n    'value' | 'size' | 'multiple' | 'empty' | 'options' | 'max' | 'loadingText' | 'loading' | 'valueType' | 'keys'\n  > {\n  onChange?: (value: SelectValue, context?: { label?: string | number; restData?: Record<string, any> }) => void;\n  /**\n   * 是否展示popup\n   */\n  showPopup: boolean;\n  /**\n   * 控制popup展示的函数\n   */\n  setShowPopup: (show: boolean) => void;\n  children?: React.ReactNode;\n}\n\nconst PopupContent = (props: SelectPopupProps) => {\n  const {\n    onChange,\n    value,\n    size,\n    max,\n    multiple,\n    showPopup,\n    setShowPopup,\n    options,\n    empty,\n    loadingText,\n    loading,\n    valueType,\n    children,\n    keys,\n  } = props;\n\n  // 国际化文本初始化\n  const [local, t] = useLocaleReceiver('select');\n  const emptyText = t(local.empty);\n\n  const { classPrefix } = useConfig();\n  if (!children && !props.options) return null;\n\n  const onSelect: SelectOptionProps['onSelect'] = (selectedValue, { label, selected, restData }) => {\n    const isValObj = valueType === 'object';\n    let objVal = {};\n    if (isValObj) {\n      objVal = { ...restData };\n      if (!keys?.label) {\n        Object.assign(objVal, { label });\n      }\n      if (!keys?.value) {\n        Object.assign(objVal, { value: selectedValue });\n      }\n    }\n\n    if (!Object.keys(objVal).length) {\n      Object.assign(objVal, { [keys?.label || 'label']: label, [keys?.value || 'value']: selectedValue });\n    }\n    if (multiple) {\n      // calc multiple select values\n      const values = getSelectValueArr(value, selectedValue, selected, valueType, keys, objVal);\n      onChange(values, { label });\n    } else {\n      // calc single select value\n      const selectVal = valueType === 'object' ? objVal : selectedValue;\n\n      onChange(selectVal, { label });\n      setShowPopup(!showPopup);\n    }\n  };\n\n  const childrenWithProps = Children.map(children, (child) => {\n    if (isValidElement(child)) {\n      const addedProps = { size, max, multiple, selectedValue: value, onSelect };\n      return cloneElement(child, { ...addedProps });\n    }\n    return child;\n  });\n\n  // 渲染 options\n  const renderOptions = () => {\n    if (options) {\n      // 通过options API配置的\n      return (\n        <ul>\n          {(options as OptionsType).map(({ value: optionValue, label, disabled, ...restData }, index) => (\n            <Option\n              key={index}\n              max={max}\n              label={label}\n              value={optionValue}\n              onSelect={onSelect}\n              selectedValue={value}\n              multiple={multiple}\n              size={size}\n              disabled={disabled}\n              restData={restData}\n              keys={keys}\n            />\n          ))}\n        </ul>\n      );\n    }\n    return <ul>{childrenWithProps}</ul>;\n  };\n\n  const isEmpty = (Array.isArray(childrenWithProps) && !childrenWithProps.length) || (options && options.length === 0);\n\n  if (isEmpty) {\n    return <div className={`${classPrefix}-select__empty`}>{empty ? empty : <p>{emptyText}</p>}</div>;\n  }\n\n  if (loading) {\n    return <div className={`${classPrefix}-select__loading-tips`}>{loadingText}</div>;\n  }\n  return <div>{renderOptions()}</div>;\n};\n\nexport default PopupContent;\n"],"names":["PopupContent","props","onChange","value","size","max","multiple","showPopup","setShowPopup","options","empty","loadingText","loading","valueType","children","keys","useLocaleReceiver","local","t","emptyText","useConfig","classPrefix","onSelect","selectedValue","label","selected","restData","isValObj","objVal","Object","assign","length","values","getSelectValueArr","selectVal","childrenWithProps","Children","map","child","isValidElement","addedProps","cloneElement","renderOptions","React","createElement","index","optionValue","disabled","Option","key","isEmpty","Array","isArray","className"],"mappings":"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"}