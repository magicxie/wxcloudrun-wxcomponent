{"version":3,"file":"Select.js","sources":["../../../src/select/base/Select.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, Ref, useMemo } from 'react';\nimport { CloseCircleFilledIcon } from 'tdesign-icons-react';\nimport classNames from 'classnames';\nimport isFunction from 'lodash/isFunction';\nimport get from 'lodash/get';\nimport isString from 'lodash/isString';\n\nimport { isNumber } from 'lodash';\nimport { useLocaleReceiver } from '../../locale/LocalReceiver';\nimport useConfig from '../../_util/useConfig';\nimport composeRefs from '../../_util/composeRefs';\nimport useDefaultValue from '../../_util/useDefaultValue';\nimport forwardRefWithStatics from '../../_util/forwardRefWithStatics';\nimport { getMultipleTags, getSelectValueArr, getValueToOption } from '../util/helper';\nimport noop from '../../_util/noop';\n\nimport FakeArrow from '../../common/FakeArrow';\nimport Loading from '../../loading';\nimport Input from '../../input';\nimport Popup from '../../popup';\nimport Tag from '../../tag';\nimport Option, { SelectOptionProps } from './Option';\nimport OptionGroup from './OptionGroup';\nimport PopupContent from './PopupContent';\n\nimport { TdSelectProps, SelectValue, TdOptionProps } from '../type';\nimport { StyledProps } from '../../common';\n\nconst MAX_OVERLAY_WIDTH = 500;\n\nexport interface SelectProps extends TdSelectProps, StyledProps {\n  // 子节点\n  children?: React.ReactNode;\n}\n\ntype OptionsType = TdOptionProps[];\n\nconst Select = forwardRefWithStatics(\n  (props: SelectProps, ref: Ref<HTMLDivElement>) => {\n    // 国际化文本初始化\n    const [local, t] = useLocaleReceiver('select');\n    const emptyText = t(local.loadingText);\n\n    const {\n      bordered = true,\n      creatable,\n      filter,\n      loadingText = emptyText,\n      max = 0,\n      popupProps,\n      reserveKeyword,\n      value,\n      className,\n      style,\n      disabled,\n      size,\n      multiple,\n      placeholder,\n      clearable,\n      prefixIcon,\n      options,\n      filterable,\n      loading,\n      onFocus,\n      onBlur,\n      onClear = noop,\n      onCreate,\n      onRemove,\n      onSearch,\n      onChange,\n      empty,\n      valueType = 'value',\n      keys,\n      children,\n      collapsedItems,\n      minCollapsedNum,\n      valueDisplay,\n      onEnter,\n      onVisibleChange,\n    } = useDefaultValue(props);\n\n    const { classPrefix } = useConfig();\n\n    const name = `${classPrefix}-select`; // t-select\n\n    const [showPopup, setShowPopup] = useState(false);\n    const [isHover, toggleHover] = useState(false);\n    const [inputVal, setInputVal] = useState<string>(undefined);\n    const [currentOptions, setCurrentOptions] = useState([]);\n    const [tmpPropOptions, setTmpPropOptions] = useState([]);\n    const [valueToOption, setValueToOption] = useState({});\n    const [selectedOptions, setSelectedOptions] = useState([]);\n\n    const [width, setWidth] = useState(0);\n\n    const selectRef = useRef(null);\n    const overlayRef = useRef(null);\n\n    const selectedLabel = useMemo(\n      () => get(selectedOptions[0] || {}, keys?.label || 'label') || '',\n      [selectedOptions, keys],\n    );\n\n    // 计算Select的宽高\n    useEffect(() => {\n      if (showPopup && selectRef?.current) {\n        const domRect = selectRef.current.getBoundingClientRect();\n        const overlayRect = overlayRef?.current?.getBoundingClientRect?.();\n\n        // 获取overlay的内容的宽度进行比较 如果比select本身宽，则优先使用overlay内容宽度，减少text被省略展示的情况\n        const width =\n          domRect.width > MAX_OVERLAY_WIDTH\n            ? domRect.width\n            : Math.min(MAX_OVERLAY_WIDTH, Math.max(domRect.width, overlayRect?.width));\n\n        setWidth(width);\n      }\n    }, [showPopup]);\n\n    const handleShowPopup = (visible: boolean) => {\n      if (disabled) return;\n      setShowPopup(visible);\n      onVisibleChange?.(visible);\n      if (!visible && !multiple && filterable) {\n        setInputVal(selectedLabel);\n      }\n    };\n\n    // 处理设置option的逻辑\n    useEffect(() => {\n      if (keys) {\n        // 如果有定制keys 先做转换\n        const transformedOptions = options.map((option) => ({\n          ...option,\n          value: get(option, keys?.value || 'value'),\n          label: get(option, keys?.label || 'label'),\n        }));\n        setCurrentOptions(transformedOptions);\n        setTmpPropOptions(transformedOptions);\n      } else {\n        setCurrentOptions(options);\n        setTmpPropOptions(options);\n      }\n      setValueToOption(getValueToOption(children, options, keys) || {});\n    }, [options, keys, children]);\n\n    // 同步value对应的options\n    useEffect(() => {\n      setSelectedOptions((oldSelectedOptions) => {\n        const valueKey = keys?.value || 'value';\n        const labelKey = keys?.label || 'label';\n        if (Array.isArray(value)) {\n          return value\n            .map((item) => {\n              if (valueType === 'value') {\n                return (\n                  valueToOption[item as string | number] ||\n                  oldSelectedOptions.find((option) => get(option, valueKey) === item) || {\n                    [valueKey]: item,\n                    [labelKey]: item,\n                  }\n                );\n              }\n              return item;\n            })\n            .filter(Boolean);\n        }\n\n        if (value !== undefined && value !== null) {\n          if (valueType === 'value') {\n            return [\n              valueToOption[value as string | number] ||\n                oldSelectedOptions.find((option) => get(option, valueKey) === value) || {\n                  [valueKey]: value,\n                  [labelKey]: value,\n                },\n            ].filter(Boolean);\n          }\n          return [value];\n        }\n        return [];\n      });\n    }, [value, keys, valueType, valueToOption]);\n\n    // 移除 Tag\n    const removeTag = (\n      event?: React.MouseEvent,\n      selectValue?: SelectValue,\n      tagData?: {\n        label?: string;\n        value?: string | number;\n      },\n    ) => {\n      event.stopPropagation();\n      const values = getSelectValueArr(value, selectValue, true, valueType, keys);\n      onChange(values);\n      if (isFunction(onRemove)) {\n        onRemove({ value: tagData.value, data: tagData, e: event as React.MouseEvent<HTMLDivElement, MouseEvent> });\n      }\n    };\n\n    // 选中 Popup 某项\n    const handleChange: SelectOptionProps['onSelect'] = (value, { label }) => {\n      if (filterable) {\n        setInputVal(!multiple || (reserveKeyword && multiple) ? label : '');\n      }\n      if (creatable && isFunction(onCreate)) {\n        if ((options as OptionsType).filter((option) => option.value === value).length === 0) {\n          onCreate(value);\n        }\n      }\n      onChange(value);\n    };\n\n    // 处理filter逻辑\n    const handleFilter = (value: string) => {\n      let filteredOptions: OptionsType;\n      if (!value) {\n        setCurrentOptions(tmpPropOptions);\n        return;\n      }\n\n      if (filter && isFunction(filter)) {\n        // 如果有自定义的filter方法 使用自定义的filter方法\n        filteredOptions = Array.isArray(tmpPropOptions) && tmpPropOptions.filter((option) => filter(value, option));\n      } else {\n        const filterRegExp = new RegExp(value, 'i');\n        filteredOptions =\n          Array.isArray(tmpPropOptions) && tmpPropOptions.filter((option) => filterRegExp.test(option?.label)); // 不区分大小写\n      }\n\n      if (creatable) {\n        filteredOptions = filteredOptions.concat([{ label: value, value }]);\n      }\n      setCurrentOptions(filteredOptions);\n    };\n\n    // 处理输入框逻辑\n    const handleInputChange = (value: string) => {\n      setInputVal(value);\n\n      if (isFunction(onSearch)) {\n        onSearch(value);\n        return;\n      }\n\n      handleFilter(value);\n    };\n\n    const defaultLabel = (\n      <span\n        className={classNames(\n          className,\n          {\n            [`${name}__placeholder`]: (!value && !isNumber(value)) || (Array.isArray(value) && value.length < 1),\n          },\n          {\n            [`${name}__single`]: selectedLabel,\n          },\n        )}\n      >\n        {selectedLabel || placeholder || '-请选择-'}\n      </span>\n    );\n\n    const renderMultipleTags = () => {\n      if (multiple && Array.isArray(value) && value.length > 0) {\n        let tags: OptionsType;\n        if (valueType === 'value') {\n          tags = getMultipleTags(selectedOptions, keys);\n        } else {\n          tags = getMultipleTags(value, keys);\n        }\n\n        if (tags.length > 0)\n          return (\n            <>\n              {tags.slice(0, minCollapsedNum).map((item) => (\n                <Tag\n                  closable={!disabled}\n                  key={item.value}\n                  onClose={({ e }) => removeTag(e, item.value, item)}\n                  disabled={disabled}\n                  size={size}\n                >\n                  {item.label}\n                </Tag>\n              ))}\n              {collapsedItems}\n              {minCollapsedNum && tags.length - minCollapsedNum > 0 && !collapsedItems ? (\n                <Tag size={size}> {`+${tags.length - minCollapsedNum}`}</Tag>\n              ) : null}\n            </>\n          );\n        return !filterable ? defaultLabel : null;\n      }\n      return !filterable ? defaultLabel : null;\n    };\n\n    const renderInput = () => (\n      <Input\n        value={isString(inputVal) ? inputVal : selectedLabel}\n        placeholder={multiple && get(value, 'length') > 0 ? null : selectedLabel || placeholder || '-请选择-'}\n        className={`${name}__input`}\n        onChange={handleInputChange}\n        size={size}\n        onFocus={(_, context) => onFocus?.({ value, e: context?.e })}\n        onBlur={(_, context) => onBlur?.({ value, e: context?.e })}\n        onEnter={(_, context) => onEnter?.({ inputValue: inputVal, value, e: context?.e })}\n      />\n    );\n\n    const onInputClick = (e: React.MouseEvent) => {\n      e.preventDefault();\n      if (!disabled) {\n        setShowPopup(!showPopup);\n        setInputVal('');\n      }\n    };\n\n    const onClearValue = (event: React.MouseEvent) => {\n      event.stopPropagation();\n      if (Array.isArray(value)) {\n        onChange([]);\n      } else {\n        onChange('');\n      }\n      setInputVal(undefined);\n      onClear({ e: event as React.MouseEvent<HTMLDivElement, MouseEvent> });\n    };\n\n    // 渲染后置图标\n    const renderSuffixIcon = () => {\n      if (loading) {\n        return (\n          <Loading\n            className={classNames(className, `${name}__right-icon`, `${name}__active-icon`)}\n            loading={true}\n            size=\"small\"\n          />\n        );\n      }\n      if (clearable && value && isHover) {\n        return (\n          <CloseCircleFilledIcon\n            onClick={clearable ? onClearValue : undefined}\n            className={classNames(className, `${name}__right-icon`, `${name}__right-icon-clear`)}\n          />\n        );\n      }\n      return <FakeArrow overlayClassName={`${name}__right-icon`} isActive={showPopup} disabled={disabled} />;\n    };\n\n    const popupContentProps = {\n      onChange: handleChange,\n      value,\n      className,\n      size,\n      multiple,\n      showPopup,\n      setShowPopup,\n      options: currentOptions,\n      empty,\n      max,\n      loadingText,\n      loading,\n      valueType,\n      keys,\n    };\n\n    const renderContent = () => <PopupContent {...popupContentProps}>{children}</PopupContent>;\n\n    const renderMultipleInput = () => {\n      if (valueDisplay) {\n        return valueDisplay({ value: value as OptionsType, onClose: removeTag }) || defaultLabel;\n      }\n      return renderMultipleTags();\n    };\n    return (\n      <div\n        className={`${name}__wrap`}\n        style={{ ...style }}\n        onMouseEnter={() => toggleHover(true)}\n        onMouseLeave={() => toggleHover(false)}\n      >\n        <Popup\n          trigger=\"click\"\n          ref={overlayRef}\n          content={renderContent()}\n          placement=\"bottom-left\"\n          visible={showPopup}\n          overlayStyle={{\n            width: width ? `${width}px` : 'none',\n          }}\n          onVisibleChange={handleShowPopup}\n          overlayClassName={classNames(className, `${name}__dropdown`, `${classPrefix}-popup`, 'narrow-scrollbar')}\n          className={`${name}__popup-reference`}\n          expandAnimation={true}\n          destroyOnClose={true}\n          {...popupProps}\n        >\n          <div\n            className={classNames(className, name, {\n              [`${classPrefix}-is-disabled`]: disabled,\n              [`${classPrefix}-is-active`]: showPopup,\n              [`${classPrefix}-size-s`]: size === 'small',\n              [`${classPrefix}-size-l`]: size === 'large',\n              [`${classPrefix}-no-border`]: !bordered,\n              [`${classPrefix}-has-prefix`]: !!prefixIcon,\n            })}\n            ref={composeRefs(selectRef, ref)}\n            style={{ userSelect: 'none' }}\n            onClick={onInputClick}\n          >\n            {<span className={`${name}__left-icon`}>{prefixIcon}</span>}\n            {multiple ? renderMultipleInput() : null}\n            {filterable && renderInput()}\n            {!multiple && !filterable && defaultLabel}\n            {renderSuffixIcon()}\n          </div>\n        </Popup>\n      </div>\n    );\n  },\n  {\n    displayName: 'Select',\n    Option,\n    OptionGroup,\n  },\n);\n\nexport default Select;\n"],"names":["MAX_OVERLAY_WIDTH","Select","forwardRefWithStatics","props","ref","useLocaleReceiver","local","t","emptyText","loadingText","useDefaultValue","bordered","creatable","filter","max","popupProps","reserveKeyword","value","className","style","disabled","size","multiple","placeholder","clearable","prefixIcon","options","filterable","loading","onFocus","onBlur","onClear","noop","onCreate","onRemove","onSearch","onChange","empty","valueType","keys","children","collapsedItems","minCollapsedNum","valueDisplay","onEnter","onVisibleChange","useConfig","classPrefix","name","useState","showPopup","setShowPopup","isHover","toggleHover","inputVal","setInputVal","currentOptions","setCurrentOptions","tmpPropOptions","setTmpPropOptions","valueToOption","setValueToOption","selectedOptions","setSelectedOptions","width","setWidth","selectRef","useRef","overlayRef","selectedLabel","useMemo","get","label","useEffect","current","domRect","getBoundingClientRect","overlayRect","width2","Math","min","handleShowPopup","visible","transformedOptions","map","option","getValueToOption","oldSelectedOptions","valueKey","labelKey","Array","isArray","item","find","Boolean","removeTag","event","selectValue","tagData","stopPropagation","values","getSelectValueArr","isFunction","data","e","handleChange","value2","length","handleFilter","filteredOptions","filterRegExp","RegExp","test","concat","handleInputChange","defaultLabel","React","createElement","classNames","isNumber","renderMultipleTags","tags","getMultipleTags","Fragment","slice","Tag","closable","key","onClose","renderInput","Input","isString","_","context","inputValue","onInputClick","preventDefault","onClearValue","renderSuffixIcon","Loading","CloseCircleFilledIcon","onClick","FakeArrow","overlayClassName","isActive","popupContentProps","renderContent","PopupContent","renderMultipleInput","onMouseEnter","onMouseLeave","Popup","trigger","content","placement","overlayStyle","expandAnimation","destroyOnClose","composeRefs","userSelect","displayName","Option","OptionGroup"],"mappings":"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"}