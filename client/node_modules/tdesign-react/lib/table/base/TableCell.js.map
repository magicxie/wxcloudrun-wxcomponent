{"version":3,"file":"TableCell.js","sources":["../../../src/table/base/TableCell.tsx"],"sourcesContent":["import React, { CSSProperties, useRef, useLayoutEffect, useState, PropsWithChildren } from 'react';\nimport classnames from 'classnames';\nimport { BaseTableCol, DataType } from '../type';\nimport useConfig from '../../_util/useConfig';\nimport { useTableContext } from './TableContext';\n\nexport interface CellProps<D extends DataType> extends BaseTableCol<DataType> {\n  columns?: BaseTableCol[];\n  type?: 'cell' | 'title';\n  record?: D;\n  style?: CSSProperties;\n  rowIndex?: number;\n  colIndex?: number;\n  rowSpan?: number;\n  colSpan?: number;\n  customRender: Function;\n  isFirstChildTdSetBorderWidth?: Boolean;\n}\n\nconst TableCell = <D extends DataType>(props: PropsWithChildren<CellProps<D>>) => {\n  const {\n    style = {},\n    width,\n    type,\n    record,\n    colKey,\n    customRender,\n    colIndex,\n    fixed,\n    align,\n    ellipsis,\n    columns,\n    rowIndex,\n    className,\n    rowSpan,\n    colSpan,\n    isFirstChildTdSetBorderWidth,\n  } = props;\n\n  const { classPrefix } = useConfig();\n  const { flattenColumns } = useTableContext();\n  const [offset, setOffset] = useState(0);\n  const [isBoundary, setIsBoundary] = useState(false);\n\n  const ref = useRef<HTMLTableDataCellElement | HTMLTableHeaderCellElement>();\n\n  useLayoutEffect(() => {\n    if (ref.current) {\n      let offset = 0;\n      const { clientWidth } = ref.current;\n      const fixedColumns = flattenColumns.filter((column) => column.fixed === fixed);\n      const indexInFixedColumns = fixedColumns.findIndex(({ colKey: key }) => key === colKey);\n\n      fixedColumns.forEach((_, cur) => {\n        if ((fixed === 'right' && cur > indexInFixedColumns) || (fixed === 'left' && cur < indexInFixedColumns)) {\n          offset += clientWidth;\n        }\n      });\n      setOffset(offset);\n\n      const isBoundary = fixed === 'left' ? indexInFixedColumns === fixedColumns.length - 1 : indexInFixedColumns === 0;\n      setIsBoundary(isBoundary);\n    }\n  }, [ref, flattenColumns, colKey, fixed]);\n\n  const cellNode = customRender({ type, row: record, rowIndex, col: columns?.[colIndex], colIndex });\n\n  // ==================== styles ====================\n  const cellStyle = { ...style };\n  if (fixed) {\n    cellStyle.position = 'sticky';\n    cellStyle[fixed] = offset;\n  }\n  if (width && !fixed) {\n    cellStyle.overflow = 'hidden';\n  }\n  if (isFirstChildTdSetBorderWidth) {\n    cellStyle.borderWidth = 1;\n  }\n\n  return (\n    <td\n      ref={ref}\n      style={cellStyle}\n      className={classnames({\n        [`${classPrefix}-table__cell--fixed-${fixed}`]: fixed,\n        [`${classPrefix}-table__cell--fixed-${fixed}-${fixed === 'left' ? 'last' : 'first'}`]: fixed && isBoundary,\n        [`${classPrefix}-align-${align}`]: align,\n        [`${classPrefix}-text-ellipsis`]: ellipsis,\n        [`${className}`]: !!className,\n      })}\n      rowSpan={rowSpan}\n      colSpan={colSpan}\n    >\n      {cellNode}\n    </td>\n  );\n};\n\nexport default TableCell;\n"],"names":["TableCell","props","style","width","type","record","colKey","customRender","colIndex","fixed","align","ellipsis","columns","rowIndex","className","rowSpan","colSpan","isFirstChildTdSetBorderWidth","useConfig","classPrefix","useTableContext","flattenColumns","useState","offset","setOffset","isBoundary","setIsBoundary","ref","useRef","useLayoutEffect","current","offset2","clientWidth","fixedColumns","filter","column","indexInFixedColumns","findIndex","key","forEach","_","cur","isBoundary2","length","cellNode","row","col","cellStyle","position","overflow","borderWidth","React","createElement","classnames"],"mappings":"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"}