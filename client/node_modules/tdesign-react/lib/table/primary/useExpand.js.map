{"version":3,"file":"useExpand.js","sources":["../../../src/table/primary/useExpand.tsx"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\nimport get from 'lodash/get';\nimport { ConfigContext } from '../../config-provider';\nimport { PrimaryTableCol } from '../type';\nimport { PrimaryTableProps } from './Table';\nimport ExpandBox from './expand-box';\n\nconst expandedColKey = 'expanded-icon-cell';\n\nexport type RowkeyType = PrimaryTableProps['expandedRowKeys'];\n\n/**\n * 展开收起hook\n * 1.返回加入展开icon的列配置 Array[]\n * 2.返回展开回调方法\n * 3.返回渲染行展开方法\n */\nfunction useExpand(props: PrimaryTableProps): [PrimaryTableCol[], Function, Function] {\n  const {\n    columns,\n    rowKey,\n    defaultExpandedRowKeys,\n    expandedRowKeys,\n    expandedRow,\n    onExpandChange,\n    expandIcon = true,\n    expandOnRowClick = false,\n  } = props;\n  const { classPrefix } = useContext(ConfigContext);\n  const isControlled = typeof expandedRowKeys !== 'undefined'; // 是否受控\n  const [innerExpandRowKeys, setThisExpandRowKeys] = useState<RowkeyType>(\n    expandedRowKeys || defaultExpandedRowKeys || [],\n  );\n\n  useEffect(() => {\n    if (Array.isArray(expandedRowKeys)) {\n      setThisExpandRowKeys([...expandedRowKeys]);\n    }\n  }, [expandedRowKeys]);\n\n  // 导出：添加展开图标后的columns\n  const transformedExpandColumnsFun = () =>\n    expandedRow\n      ? [\n          {\n            colKey: expandedColKey,\n            width: 25,\n            className: [`${classPrefix}-table__expandable-icon-cell`],\n            cell: ({ row }) => renderExpandIconCell({ row }),\n          },\n          ...columns,\n        ]\n      : columns;\n\n  const transformedExpandColumns = transformedExpandColumnsFun();\n\n  // 渲染展开单元格内容\n  function renderExpandIconCell({ row = {} }: Record<string, any>) {\n    const rowKeyValue = get(row, rowKey);\n    if (!Array.isArray(innerExpandRowKeys)) {\n      console.error('ExpandedRowKeys type error');\n      return;\n    }\n    return (\n      <ExpandBox\n        expanded={innerExpandRowKeys?.includes(rowKeyValue)}\n        row={row}\n        rowKeyValue={rowKeyValue}\n        expandIcon={expandIcon}\n        expandOnRowClick={expandOnRowClick}\n        handleExpandChange={handleExpandChange}\n      />\n    );\n  }\n\n  // 导出：触发展开回调方法\n  function handleExpandChange(row, rowKeyValue) {\n    let innerExpandRowKeysNew: RowkeyType;\n    const isExpanded = innerExpandRowKeys?.includes(rowKeyValue);\n    if (isExpanded) {\n      innerExpandRowKeysNew = innerExpandRowKeys.filter((item) => item !== rowKeyValue);\n    } else {\n      innerExpandRowKeysNew = [...innerExpandRowKeys, rowKeyValue];\n    }\n\n    if (!isControlled) {\n      setThisExpandRowKeys([...innerExpandRowKeysNew]);\n    }\n\n    // 触发回调\n    typeof onExpandChange === 'function' && onExpandChange(innerExpandRowKeysNew, { expandedRowData: row });\n  }\n\n  // 导出：渲染行展开方法\n  function renderExpandRow(row, index, rowKeyValue) {\n    return (\n      <tr\n        className={`${classPrefix}-table__expanded-cell`}\n        style={innerExpandRowKeys?.includes?.(rowKeyValue) ? {} : { display: 'none' }}\n      >\n        <td colSpan={transformedExpandColumns?.length}>{expandedRow && expandedRow({ row, index })}</td>\n      </tr>\n    );\n  }\n\n  return [transformedExpandColumns, handleExpandChange, renderExpandRow];\n}\n\nexport default useExpand;\n"],"names":["expandedColKey","useExpand","props","columns","rowKey","defaultExpandedRowKeys","expandedRowKeys","expandedRow","onExpandChange","expandIcon","expandOnRowClick","useContext","ConfigContext","classPrefix","isControlled","useState","innerExpandRowKeys","setThisExpandRowKeys","useEffect","Array","isArray","transformedExpandColumnsFun","colKey","width","className","cell","row","renderExpandIconCell","transformedExpandColumns","rowKeyValue","get","console","error","React","createElement","ExpandBox","expanded","includes","handleExpandChange","innerExpandRowKeysNew","isExpanded","filter","item","expandedRowData","renderExpandRow","index","style","display","colSpan","length"],"mappings":"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"}