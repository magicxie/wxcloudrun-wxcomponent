{"version":3,"file":"index.js","sources":["../../../../src/upload/themes/flow-list/index.tsx"],"sourcesContent":["import React, { DragEvent, MouseEvent, ReactNode, useState } from 'react';\nimport classNames from 'classnames';\nimport useConfig from '../../../_util/useConfig';\nimport Button from '../../../button';\nimport { UploadFile } from '../../type';\nimport { FlowRemoveContext } from '../../types';\nimport ImgList from './img-list';\nimport FileList from './file-list';\nimport BooleanRender from '../../boolean-render';\n\nexport interface CommonListProps {\n  renderDragger: () => React.ReactElement;\n  showInitial: boolean;\n  listFiles: UploadFile[];\n}\n\nexport interface FlowListProps {\n  children?: ReactNode;\n  files?: UploadFile[];\n  showUploadProgress?: boolean;\n  toUploadFiles?: UploadFile[];\n  placeholder: string;\n  display: 'file-flow' | 'image-flow';\n  remove: (ctx: FlowRemoveContext) => void;\n  upload: (files: UploadFile[], e: MouseEvent) => void;\n  cancel: (e: MouseEvent) => void;\n  onImgPreview: (e: MouseEvent, files: UploadFile) => void;\n  onChange: (files: FileList) => void;\n  onDragenter: (e: React.DragEvent) => void;\n  onDragleave: (e: React.DragEvent) => void;\n}\n\nconst Index: React.FC<FlowListProps> = (props) => {\n  const {\n    files: listFiles,\n    toUploadFiles = [],\n    showUploadProgress = false,\n    placeholder,\n    display,\n    onImgPreview,\n    remove,\n    upload,\n    cancel,\n    onChange,\n    onDragenter,\n    onDragleave,\n    children = null,\n  } = props;\n  const target = React.useRef();\n  const { classPrefix: prefix } = useConfig();\n  const UPLOAD_NAME = `${prefix}-upload`;\n  const [dragActive, setDragActive] = useState(false);\n  const showInitial = !listFiles.length;\n  const failedList = toUploadFiles.filter((file) => file.status === 'fail');\n  const isUploading = toUploadFiles.filter((file) => file.status === 'progress').length > 0;\n  const allowUpload = toUploadFiles.length > 0 && !isUploading;\n  let uploadText = failedList.length ? '重新上传' : '开始上传';\n  if (isUploading) uploadText = '上传中...';\n\n  const handleDrop = (event: DragEvent) => {\n    event.preventDefault();\n    onChange?.(event.dataTransfer.files);\n    onDragleave?.(event);\n    setDragActive(false);\n  };\n  const handleDragenter = (event: DragEvent) => {\n    event.preventDefault();\n    onDragenter?.(event);\n    setDragActive(true);\n  };\n  const handleDragleave = (event: DragEvent) => {\n    if (event.target !== target.current) return;\n    event.preventDefault();\n    onDragleave?.(event);\n    setDragActive(false);\n  };\n  const handleDragover = (event: DragEvent) => {\n    event.preventDefault();\n  };\n\n  const renderDragger = () => (\n    <div\n      ref={target}\n      className={`${UPLOAD_NAME}__flow-empty`}\n      onDrop={handleDrop}\n      onDragEnter={handleDragenter}\n      onDragOver={handleDragover}\n      onDragLeave={handleDragleave}\n    >\n      {dragActive ? '释放鼠标' : '点击上方“选择文件”或将文件拖拽到此区域'}\n    </div>\n  );\n  const wrapperClassNames = classNames({\n    [`${UPLOAD_NAME}__flow`]: true,\n    [`${UPLOAD_NAME}__flow-${display}`]: true,\n  });\n\n  return (\n    <div className={wrapperClassNames}>\n      <div className={`${UPLOAD_NAME}__flow-op`}>\n        {children}\n        <small className={`${UPLOAD_NAME}__small ${UPLOAD_NAME}__flow-placeholder`}>{placeholder}</small>\n      </div>\n      <BooleanRender boolExpression={display === 'file-flow'}>\n        <FileList\n          listFiles={listFiles}\n          showInitial={showInitial}\n          renderDragger={renderDragger}\n          showUploadProgress={showUploadProgress}\n          remove={remove}\n        />\n      </BooleanRender>\n      <BooleanRender boolExpression={display === 'image-flow'}>\n        <ImgList\n          listFiles={listFiles}\n          showInitial={showInitial}\n          renderDragger={renderDragger}\n          onImgPreview={onImgPreview}\n          remove={remove}\n        />\n      </BooleanRender>\n      <div className={`${UPLOAD_NAME}__flow-bottom`}>\n        <Button theme=\"default\" onClick={cancel}>\n          取消\n        </Button>\n        <Button disabled={!allowUpload} theme=\"primary\" onClick={(e: MouseEvent) => upload(toUploadFiles, e)}>\n          {uploadText}\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nexport default Index;\n"],"names":["Index","props","listFiles","files","toUploadFiles","showUploadProgress","placeholder","display","onImgPreview","remove","upload","cancel","onChange","onDragenter","onDragleave","children","target","React","useRef","useConfig","prefix","classPrefix","UPLOAD_NAME","useState","dragActive","setDragActive","showInitial","length","failedList","filter","file","status","isUploading","allowUpload","uploadText","handleDrop","event","preventDefault","dataTransfer","handleDragenter","handleDragleave","current","handleDragover","renderDragger","createElement","ref","className","onDrop","onDragEnter","onDragOver","onDragLeave","wrapperClassNames","classNames","BooleanRender","boolExpression","FileList","ImgList","Button","theme","onClick","disabled","e"],"mappings":"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"}