{"version":3,"file":"single-file.js","sources":["../../../src/upload/themes/single-file.tsx"],"sourcesContent":["import React, { FC, useCallback } from 'react';\nimport classNames from 'classnames';\nimport { CloseCircleFilledIcon, ErrorCircleFilledIcon } from 'tdesign-icons-react';\nimport Loading from '../../loading';\nimport { UploadFile, UploadRemoveContext } from '../type';\nimport useConfig from '../../_util/useConfig';\n\nexport interface SingleFileProps {\n  file?: UploadFile;\n  display?: string;\n  placeholder?: string;\n  onRemove?: (context: UploadRemoveContext) => void;\n  showUploadProgress: boolean;\n}\n\nconst SingleFile: FC<SingleFileProps> = (props) => {\n  const { display = 'file', onRemove, file, showUploadProgress } = props;\n  const { classPrefix } = useConfig();\n\n  const fileClass = classNames(`${classPrefix}-upload__single`, `${classPrefix}-upload__single-${display}`);\n\n  const showProgress = showUploadProgress && file && file.status !== 'success';\n\n  const inputName = file?.name;\n\n  const handleRemove = useCallback(\n    (e) => {\n      onRemove?.({\n        e,\n        file,\n        index: 0,\n      });\n    },\n    [file, onRemove],\n  );\n\n  const renderProgress = useCallback(() => {\n    if (file?.status === 'fail') {\n      return <ErrorCircleFilledIcon />;\n    }\n\n    return (\n      <div className={`${classPrefix}-upload__single-progress`}>\n        <Loading loading={true} size=\"small\" />\n        <span className={`${classPrefix}-upload__single-percent`}>{Math.min(file?.percent || 0, 99)}%</span>\n      </div>\n    );\n  }, [classPrefix, file]);\n\n  // 文本型预览\n  const renderFilePreviewAsText = useCallback(() => {\n    if (!inputName) return;\n    return (\n      <div className={`${classPrefix}-upload__single-display-text ${classPrefix}-upload__display-text--margin`}>\n        <span className={`${classPrefix}-upload__single-name`}>{inputName}</span>\n        {showProgress ? (\n          renderProgress()\n        ) : (\n          <CloseCircleFilledIcon className={`${classPrefix}-upload__icon-delete`} onClick={handleRemove} />\n        )}\n      </div>\n    );\n  }, [classPrefix, inputName, renderProgress, showProgress, handleRemove]);\n\n  return (\n    <div className={fileClass}>\n      {props.children}\n      {display === 'file' && renderFilePreviewAsText()}\n    </div>\n  );\n};\n\nexport default SingleFile;\n"],"names":["SingleFile","props","display","onRemove","file","showUploadProgress","useConfig","classPrefix","fileClass","classNames","showProgress","status","inputName","name","handleRemove","useCallback","e","index","renderProgress","React","createElement","ErrorCircleFilledIcon","className","Loading","loading","size","Math","min","percent","renderFilePreviewAsText","CloseCircleFilledIcon","onClick","children"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAKMA,UAAU,GAAG,SAAbA,UAAa,CAACC,KAAD,EAAW;AAC5B,uBAAiEA,KAAjE,CAAQC,OAAR;AAAA,MAAQA,OAAR,+BAAkB,MAAlB;AAAA,MAA0BC,QAA1B,GAAiEF,KAAjE,CAA0BE,QAA1B;AAAA,MAAoCC,IAApC,GAAiEH,KAAjE,CAAoCG,IAApC;AAAA,MAA0CC,kBAA1C,GAAiEJ,KAAjE,CAA0CI,kBAA1C;;AACA,mBAAwBC,SAAS,EAAjC;AAAA,MAAQC,WAAR,cAAQA,WAAR;;AACA,MAAMC,SAAS,GAAGC,UAAU,WAAIF,WAAJ,gCAAqCA,WAArC,6BAAmEL,OAAnE,EAA5B;AACA,MAAMQ,YAAY,GAAGL,kBAAkB,IAAID,IAAtB,IAA8BA,IAAI,CAACO,MAAL,KAAgB,SAAnE;AACA,MAAMC,SAAS,GAAGR,IAAH,aAAGA,IAAH,uBAAGA,IAAI,CAAES,IAAxB;AACA,MAAMC,YAAY,GAAGC,WAAW,CAAC,UAACC,CAAD,EAAO;AACtCb,IAAAA,QAAQ,SAAR,IAAAA,QAAQ,WAAR,YAAAA,QAAQ,CAAG;AACTa,MAAAA,CAAC,EAADA,CADS;AAETZ,MAAAA,IAAI,EAAJA,IAFS;AAGTa,MAAAA,KAAK,EAAE;AAHE,KAAH,CAAR;AAKD,GAN+B,EAM7B,CAACb,IAAD,EAAOD,QAAP,CAN6B,CAAhC;AAOA,MAAMe,cAAc,GAAGH,WAAW,CAAC,YAAM;AACvC,QAAI,CAAAX,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAEO,MAAN,MAAiB,MAArB,EAA6B;AAC3B,4BAAuBQ,KAAK,CAACC,aAAN,CAAoBC,qBAApB,EAA2C,IAA3C,CAAvB;AACD;;AACD,0BAAuBF,KAAK,CAACC,aAAN,CAAoB,KAApB,EAA2B;AAChDE,MAAAA,SAAS,YAAKf,WAAL;AADuC,KAA3B,iBAEJY,KAAK,CAACC,aAAN,CAAoBG,OAApB,EAA6B;AAC9CC,MAAAA,OAAO,EAAE,IADqC;AAE9CC,MAAAA,IAAI,EAAE;AAFwC,KAA7B,CAFI,iBAKHN,KAAK,CAACC,aAAN,CAAoB,MAApB,EAA4B;AAC9CE,MAAAA,SAAS,YAAKf,WAAL;AADqC,KAA5B,EAEjBmB,IAAI,CAACC,GAAL,CAAS,CAAAvB,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAEwB,OAAN,KAAiB,CAA1B,EAA6B,EAA7B,CAFiB,EAEiB,GAFjB,CALG,CAAvB;AAQD,GAZiC,EAY/B,CAACrB,WAAD,EAAcH,IAAd,CAZ+B,CAAlC;AAaA,MAAMyB,uBAAuB,GAAGd,WAAW,CAAC,YAAM;AAChD,QAAI,CAACH,SAAL,EACE;AACF,0BAAuBO,KAAK,CAACC,aAAN,CAAoB,KAApB,EAA2B;AAChDE,MAAAA,SAAS,YAAKf,WAAL,0CAAgDA,WAAhD;AADuC,KAA3B,iBAEJY,KAAK,CAACC,aAAN,CAAoB,MAApB,EAA4B;AAC7CE,MAAAA,SAAS,YAAKf,WAAL;AADoC,KAA5B,EAEhBK,SAFgB,CAFI,EAIRF,YAAY,GAAGQ,cAAc,EAAjB,kBAAsCC,KAAK,CAACC,aAAN,CAAoBU,qBAApB,EAA2C;AAC1GR,MAAAA,SAAS,YAAKf,WAAL,yBADiG;AAE1GwB,MAAAA,OAAO,EAAEjB;AAFiG,KAA3C,CAJ1C,CAAvB;AAQD,GAX0C,EAWxC,CAACP,WAAD,EAAcK,SAAd,EAAyBM,cAAzB,EAAyCR,YAAzC,EAAuDI,YAAvD,CAXwC,CAA3C;AAYA,wBAAuBK,KAAK,CAACC,aAAN,CAAoB,KAApB,EAA2B;AAChDE,IAAAA,SAAS,EAAEd;AADqC,GAA3B,EAEpBP,KAAK,CAAC+B,QAFc,EAEJ9B,OAAO,KAAK,MAAZ,IAAsB2B,uBAAuB,EAFzC,CAAvB;AAGD;;;;"}